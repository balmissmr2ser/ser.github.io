<!DOCTYPE html><html><head>
      <title>SER - U06 Linux SSH</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.25/dist/katex.min.css">
      
      
      
      
      
      <style>
      @import url(https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css);
code[class*=language-],pre[class*=language-]{color:#333;background:0 0;font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.4;-moz-tab-size:8;-o-tab-size:8;tab-size:8;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:.8em;overflow:auto;border-radius:3px;background:#f5f5f5}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal;background:#f5f5f5}.token.blockquote,.token.comment{color:#969896}.token.cdata{color:#183691}.token.doctype,.token.macro.property,.token.punctuation,.token.variable{color:#333}.token.builtin,.token.important,.token.keyword,.token.operator,.token.rule{color:#a71d5d}.token.attr-value,.token.regex,.token.string,.token.url{color:#183691}.token.atrule,.token.boolean,.token.code,.token.command,.token.constant,.token.entity,.token.number,.token.property,.token.symbol{color:#0086b3}.token.prolog,.token.selector,.token.tag{color:#63a35c}.token.attr-name,.token.class,.token.class-name,.token.function,.token.id,.token.namespace,.token.pseudo-class,.token.pseudo-element,.token.url-reference .token.variable{color:#795da3}.token.entity{cursor:help}.token.title,.token.title .token.punctuation{font-weight:700;color:#1d3e81}.token.list{color:#ed6a43}.token.inserted{background-color:#eaffea;color:#55a532}.token.deleted{background-color:#ffecec;color:#bd2c00}.token.bold{font-weight:700}.token.italic{font-style:italic}.language-json .token.property{color:#183691}.language-markup .token.tag .token.punctuation{color:#333}.language-css .token.function,code.language-css{color:#0086b3}.language-yaml .token.atrule{color:#63a35c}code.language-yaml{color:#183691}.language-ruby .token.function{color:#333}.language-markdown .token.url{color:#795da3}.language-makefile .token.symbol{color:#795da3}.language-makefile .token.variable{color:#183691}.language-makefile .token.builtin{color:#0086b3}.language-bash .token.keyword{color:#0086b3}pre[data-line]{position:relative;padding:1em 0 1em 3em}pre[data-line] .line-highlight-wrapper{position:absolute;top:0;left:0;background-color:transparent;display:block;width:100%}pre[data-line] .line-highlight{position:absolute;left:0;right:0;padding:inherit 0;margin-top:1em;background:hsla(24,20%,50%,.08);background:linear-gradient(to right,hsla(24,20%,50%,.1) 70%,hsla(24,20%,50%,0));pointer-events:none;line-height:inherit;white-space:pre}pre[data-line] .line-highlight:before,pre[data-line] .line-highlight[data-end]:after{content:attr(data-start);position:absolute;top:.4em;left:.6em;min-width:1em;padding:0 .5em;background-color:hsla(24,20%,50%,.4);color:#f4f1ef;font:bold 65%/1.5 sans-serif;text-align:center;vertical-align:.3em;border-radius:999px;text-shadow:none;box-shadow:0 1px #fff}pre[data-line] .line-highlight[data-end]:after{content:attr(data-end);top:auto;bottom:.4em}html body{font-family:'Helvetica Neue',Helvetica,'Segoe UI',Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ol,html body>ul{margin-bottom:16px}html body ol,html body ul{padding-left:2em}html body ol.no-list,html body ul.no-list{padding:0;list-style-type:none}html body ol ol,html body ol ul,html body ul ol,html body ul ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:700;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:700}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::after,html body code::before{letter-spacing:-.2em;content:'\00a0'}html body pre>code{padding:0;margin:0;word-break:normal;white-space:pre;background:0 0;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:after,html body pre code:before,html body pre tt:after,html body pre tt:before{content:normal}html body blockquote,html body dl,html body ol,html body p,html body pre,html body ul{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body code,html body pre{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview ul{list-style:disc}.markdown-preview ul ul{list-style:circle}.markdown-preview ul ul ul{list-style:square}.markdown-preview ol{list-style:decimal}.markdown-preview ol ol,.markdown-preview ul ol{list-style-type:lower-roman}.markdown-preview ol ol ol,.markdown-preview ol ul ol,.markdown-preview ul ol ol,.markdown-preview ul ul ol{list-style-type:lower-alpha}.markdown-preview .newpage,.markdown-preview .pagebreak{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center!important}.markdown-preview:not([data-for=preview]) .code-chunk .code-chunk-btn-group{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .status{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .output-div{margin-bottom:16px}.markdown-preview .md-toc{padding:0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link div,.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}.markdown-preview .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0;min-height:100vh}@media screen and (min-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{font-size:14px!important;padding:1em}}@media print{html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc{padding:0 16px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link div,html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% - 300px);padding:2em calc(50% - 457px - 300px / 2);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}@font-face{font-family:"Material Icons";font-style:normal;font-weight:400;src:local("Material Icons"),local("MaterialIcons-Regular"),url("data:application/x-font-woff;charset=utf-8;base64,d09GRgABAAAAAAfIAAsAAAAADDAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABHU1VCAAABCAAAADMAAABCsP6z7U9TLzIAAAE8AAAARAAAAFZW7kosY21hcAAAAYAAAADTAAACjtP6ytBnbHlmAAACVAAAAxgAAAQ4zRtvlGhlYWQAAAVsAAAALwAAADYRwZsnaGhlYQAABZwAAAAcAAAAJAeKAzxobXR4AAAFuAAAABIAAAA8OGQAAGxvY2EAAAXMAAAAIAAAACAG5AfwbWF4cAAABewAAAAfAAAAIAEfAERuYW1lAAAGDAAAAVcAAAKFkAhoC3Bvc3QAAAdkAAAAYgAAAK2vz7wkeJxjYGRgYOBikGPQYWB0cfMJYeBgYGGAAJAMY05meiJQDMoDyrGAaQ4gZoOIAgCKIwNPAHicY2BkPsQ4gYGVgYOpk+kMAwNDP4RmfM1gxMjBwMDEwMrMgBUEpLmmMDgwVLy4xKzzX4chhrmK4QpQmBEkBwAZygyweJzFkr0NwjAQhZ+TEP6CRUfHBEwRUWaQTICyQbpMwRCskA5RUIONxG0RnnNpKAIV4qzPku/8c353ACYAYrIjCWCuMAh2ptf0/hiL3p/gyPUWa3osqlt0L1zu9r71z8dGrJRykFoauXQd932Lj5vhG+MjxGeYI8MKETObMpslf5EyP8tg+vHun5r539PvlvXzaVhRFVQDTPEWKVQR90KhnnC5Ek67vUKN4VuFasM/ldARj43CCkCsEjpJSoVVgRyU0GVSK6wUpFFCx8lFgX0BiXpRPQB4nE2TTWjcRhTH3xttpDhxN7uxPlp3u/FK7moRPixafRijNosxSw/LUsIwNcaEHPZggo/FmEKMCKWU4kNOOftQSlhE8alnH0Ix9BqWnHooPRrTQ0+mnu2bXTu2pPdGM9LM/6c3fwECTM4gBBMYQNqxzLrZAjqYSlqu2TAHZQA0/DQJH6FtzqGDnvbt4Ggwvzw/nL8EfH8kW0fsuRqhgWXZnY7M1picaUL7Du5BHeDzMIl83dAt016wH1qmvtSMo5R6YRJHTR//FXsff/nj/tc/5K9P5d+nP22+fFK5u7v3K39SW3y+OtDKO3L85vD09PD9z5X17a2N1g4tqk01RlqX7gyoEmnsWQtVr4rtZMmukEaFBZxzefkCn11cyKMLZgshRwgTYNoLNXCBz2ja7HvZG7hDpPSNfoo5vs0knK/9hb+rNpu+8kHPgk/Ao4kK3tWtTpSEtvkA9c+wE6UaUdwieNkaHg55tBEtRiEPw1s0+FtrtTcc9two2lhMknV7PZF/cs6+uUFTmpTGbEx7sQCPSLOttHS3GRltqp7SNzVSKzl6aWnZT/CX5k6/v9N3Hh8fHBwffJVjhrC6OgH5dkIt/tPsq+d/PD5Qz7G7efzq1THFjdZVPe/N6ulQ3JnDWSE5junsFsVIiFwL/htf1S5gJ3BfOcUxfHKLnzqpFpyfZ9cX+/5WB6a+Y0pHpzkNrYNVDwMsikK+y7WuLCRg/oFHkA8VT3rDg5ZnU6ktzzINymV0m74Xd5pfIGXyFeVEQSShkzqG7TBBa2OxVRKitLXv7h3uuftXnXq7lz2tZ/WnWa9dx9dCjDhHzmuVQATlmljr9dZErUydSo2Hbi/b1vXtrOeGCk2/8s3ZlO8+ueJT8BVlw5pGw2oYccdSiHHqx0RlabHqdNR9jAETl6PreJcPBnnfpTLnOQ8C3OV8AmQGzouV1iZdeb5SSIoVc8W8/kcDtksUH5FrU6/aqBqNWcMEzxG4DAQ14qRQhi9mWU0rzepKezbjfgCwQKxVYq5ajRgpRqy45CqwkJydcEkbTkvRz8P5/2ZpDTN4nGNgZGBgAOKb6v+/xvPbfGXgZmEAgeuB2kkI+v8bFgbmKiCXg4EJJAoAPyAKhQB4nGNgZGBg1vmvwxDDwgACQJKRARXwAwAzZQHQeJxjYQCCFAYGFgbSMQAcWACdAAAAAAAAAAwALgBgAIQAmADSAQgBIgE8AVABoAHeAfwCHHicY2BkYGDgZ7BgYGMAASYg5gJCBob/YD4DAA/hAWQAeJxlkbtuwkAURMc88gApQomUJoq0TdIQzEOpUDokKCNR0BuzBiO/tF6QSJcPyHflE9Klyyekz2CuG8cr7547M3d9JQO4xjccnJ57vid2cMHqxDWc40G4Tv1JuEF+Fm6ijRfhM+oz4Ra6eBVu4wZvvMFpXLIa40PYQQefwjVc4Uu4Tv1HuEH+FW7i1mkKn6Hj3Am3sHC6wm08Ou8tpSZGe1av1PKggjSxPd8zJtSGTuinyVGa6/Uu8kxZludCmzxMEzV0B6U004k25W35fj2yNlCBSWM1paujKFWZSbfat+7G2mzc7weiu34aczzFNYGBhgfLfcV6iQP3ACkSaj349AxXSN9IT0j16JepOb01doiKbNWt1ovippz6sVYYwsXgX2rGVFIkq7Pl2PNrI6qW6eOshj0xaSq9mpNEZIWs8LZUfOouNkVXxp/d5woqebeYIf4D2J1ywQB4nG3LOw6AIBAE0B384B+PAkgEa+QwNnYmHt+EpXSal5lkSBBnoP8oCFSo0aCFRIceA0ZMmLFAYSW88rmvtMUjG3RiQ9HvpfusM6zWNmtc5H/iPewha50tOt5PS/QBx2IeSwAA") format("woff")}.admonition{box-shadow:0 2px 2px 0 rgba(0,0,0,.14),0 1px 5px 0 rgba(0,0,0,.12),0 3px 1px -2px rgba(0,0,0,.2);position:relative;margin:1.5625em 0;padding:0 1.2rem;border-left:.4rem solid rgba(68,138,255,.8);border-radius:.2rem;background-color:rgba(255,255,255,.05);overflow:auto}.admonition>p{margin-top:.8rem}.admonition>.admonition-title{margin:0 -1.2rem;padding:.8rem 1.2rem .8rem 3.6rem;border-bottom:1px solid rgba(68,138,255,.2);background-color:rgba(68,138,255,.1);font-weight:700}.admonition>.admonition-title:before{position:absolute;left:1.2rem;font-size:1.5rem;color:rgba(68,138,255,.8);content:"\E3C9"}.admonition>.admonition-title:before{font-family:Material Icons;font-style:normal;font-variant:normal;font-weight:400;line-height:2rem;text-transform:none;white-space:nowrap;speak:none;word-wrap:normal;direction:ltr}.admonition.abstract,.admonition.summary,.admonition.tldr{border-left-color:rgba(0,176,255,.8)}.admonition.abstract>.admonition-title,.admonition.summary>.admonition-title,.admonition.tldr>.admonition-title{background-color:rgba(0,176,255,.1);border-bottom-color:rgba(0,176,255,.2)}.admonition.abstract>.admonition-title:before,.admonition.summary>.admonition-title:before,.admonition.tldr>.admonition-title:before{color:#00b0ff;content:"\E8D2"}.admonition.hint,.admonition.tip{border-left-color:rgba(0,191,165,.8)}.admonition.hint>.admonition-title,.admonition.tip>.admonition-title{background-color:rgba(0,191,165,.1);border-bottom-color:rgba(0,191,165,.2)}.admonition.hint>.admonition-title:before,.admonition.tip>.admonition-title:before{color:#00bfa5;content:"\E80E"}.admonition.info,.admonition.todo{border-left-color:rgba(0,184,212,.8)}.admonition.info>.admonition-title,.admonition.todo>.admonition-title{background-color:rgba(0,184,212,.1);border-bottom-color:rgba(0,184,212,.2)}.admonition.info>.admonition-title:before,.admonition.todo>.admonition-title:before{color:#00b8d4;content:"\E88E"}.admonition.check,.admonition.done,.admonition.success{border-left-color:rgba(0,200,83,.8)}.admonition.check>.admonition-title,.admonition.done>.admonition-title,.admonition.success>.admonition-title{background-color:rgba(0,200,83,.1);border-bottom-color:rgba(0,200,83,.2)}.admonition.check>.admonition-title:before,.admonition.done>.admonition-title:before,.admonition.success>.admonition-title:before{color:#00c853;content:"\E876"}.admonition.faq,.admonition.help,.admonition.question{border-left-color:rgba(100,221,23,.8)}.admonition.faq>.admonition-title,.admonition.help>.admonition-title,.admonition.question>.admonition-title{background-color:rgba(100,221,23,.1);border-bottom-color:rgba(100,221,23,.2)}.admonition.faq>.admonition-title:before,.admonition.help>.admonition-title:before,.admonition.question>.admonition-title:before{color:#64dd17;content:"\E887"}.admonition.attention,.admonition.caution,.admonition.warning{border-left-color:rgba(255,145,0,.8)}.admonition.attention>.admonition-title,.admonition.caution>.admonition-title,.admonition.warning>.admonition-title{background-color:rgba(255,145,0,.1);border-bottom-color:rgba(255,145,0,.2)}.admonition.attention>.admonition-title:before{color:#ff9100;content:"\E417"}.admonition.caution>.admonition-title:before,.admonition.warning>.admonition-title:before{color:#ff9100;content:"\E002"}.admonition.fail,.admonition.failure,.admonition.missing{border-left-color:rgba(255,82,82,.8)}.admonition.fail>.admonition-title,.admonition.failure>.admonition-title,.admonition.missing>.admonition-title{background-color:rgba(255,82,82,.1);border-bottom-color:rgba(255,82,82,.2)}.admonition.fail>.admonition-title:before,.admonition.failure>.admonition-title:before,.admonition.missing>.admonition-title:before{color:#ff5252;content:"\E14C"}.admonition.bug,.admonition.danger,.admonition.error{border-left-color:rgba(255,23,68,.8)}.admonition.bug>.admonition-title,.admonition.danger>.admonition-title,.admonition.error>.admonition-title{background-color:rgba(255,23,68,.1);border-bottom-color:rgba(255,23,68,.2)}.admonition.danger>.admonition-title:before{color:#ff1744;content:"\E3E7"}.admonition.error>.admonition-title:before{color:#ff1744;content:"\E14C"}.admonition.bug>.admonition-title:before{color:#ff1744;content:"\E868"}.admonition.example,.admonition.snippet{border-left-color:rgba(0,184,212,.8)}.admonition.example>.admonition-title,.admonition.snippet>.admonition-title{background-color:rgba(0,184,212,.1);border-bottom-color:rgba(0,184,212,.2)}.admonition.example>.admonition-title:before,.admonition.snippet>.admonition-title:before{color:#00b8d4;content:"\E242"}.admonition.cite,.admonition.quote{border-left-color:rgba(158,158,158,.8)}.admonition.cite>.admonition-title,.admonition.quote>.admonition-title{background-color:rgba(158,158,158,.1);border-bottom-color:rgba(158,158,158,.2)}.admonition.cite>.admonition-title:before,.admonition.quote>.admonition-title:before{color:#9e9e9e;content:"\E244"}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */

@font-face {
  font-family: 'Catamaran';
  font-style: normal;
  font-weight: 400;
  src: url(https://fonts.gstatic.com/s/catamaran/v28/o-0bIpQoyXQa2RxT7-5B6Ryxs2E_6n1iPHjd5a7dvg.ttf) format('truetype');
}
.markdown-preview.markdown-preview {
  font-family: Verdana, Arial, "Times New Roman", sans-serif;
  font-size: 14px;
}
.markdown-preview.markdown-preview .box_bg_lightgray {
  background-color: #f5f5f5;
  border: 2px solid #969696;
  padding: 15px;
  margin-top: 15px;
  margin-bottom: 15px;
  border-radius: 5px;
  box-shadow: 0 0 7px 0 rgba(78, 120, 158, 0.1);
}
.markdown-preview.markdown-preview .box_bg_lightgreen {
  background-color: #f5faf5;
  border: 2px solid #969b96;
  padding-left: 15px;
  padding-right: 15px;
  margin-top: 15px;
  margin-bottom: 15px;
  border-radius: 5px;
  box-shadow: 0 0 7px 0 rgba(78, 120, 158, 0.1);
}
.markdown-preview.markdown-preview .contenedor {
  display: flex;
  justify-content: center;
  margin: 30px auto 30px auto;
}
.markdown-preview.markdown-preview .fondo {
  background: url(https://ser.smr2.iesdoctorbalmis.info/assets/fondo.png);
  background-size: cover;
  width: 75%;
  height: 160px;
  border-radius: 10px;
  position: relative;
}
.markdown-preview.markdown-preview .cita {
  font-family: Arial;
  font-style: italic;
  font-weight: 600;
  text-align: justify;
  line-height: 1.5rem;
  opacity: 0.6;
  color: white;
  padding: 5rem;
  position: relative;
  top: 50%;
  left: 50%;
  font-size: 1.3rem;
  transform: translate(-50%, -50%);
}
.markdown-preview.markdown-preview .abre_comilla {
  font-family: "Catamaran";
  font-weight: 600;
  color: white;
  padding-left: 30px;
  position: absolute;
  font-size: 6rem;
  transform: translate(0%, -15%);
}
.markdown-preview.markdown-preview .cierra_comilla {
  font-family: "Catamaran";
  font-weight: 600;
  color: white;
  padding-right: 30px;
  right: 0%;
  position: absolute;
  font-size: 6rem;
  transform: translate(0%, 55%);
}
.markdown-preview.markdown-preview .autor {
  font-family: Arial;
  color: white;
  margin: 0px;
  padding-left: 30px;
  position: absolute;
  top: 83%;
  font-size: 1rem;
}
.markdown-preview.markdown-preview .flotante {
  display: flex;
  margin-top: 15px;
  margin-bottom: 15px;
}
@media (max-width: 550px) {
  .markdown-preview.markdown-preview .flotante {
    justify-content: center;
  }
}
@media (min-width: 550px) {
  .markdown-preview.markdown-preview .flotante {
    justify-content: space-between;
  }
}
@media (max-width: 550px) {
  .markdown-preview.markdown-preview .flotante {
    flex-direction: column;
  }
}
@media (min-width: 550px) {
  .markdown-preview.markdown-preview .flotante {
    flex-direction: row;
  }
}
.markdown-preview.markdown-preview .flotante_izq {
  margin-right: 15px;
}
@media (max-width: 550px) {
  .markdown-preview.markdown-preview .flotante_izq {
    width: 100%;
  }
}
@media (min-width: 550px) {
  .markdown-preview.markdown-preview .flotante_izq {
    width: auto;
  }
}
@media (max-width: 550px) {
  .markdown-preview.markdown-preview .flotante_der {
    width: 100%;
  }
}
@media (min-width: 550px) {
  .markdown-preview.markdown-preview .flotante_der {
    width: auto;
  }
}
.markdown-preview.markdown-preview .galeria_imagenes {
  display: flex;
  justify-content: space-evenly;
  align-items: center;
  margin-top: 15px;
  margin-bottom: 15px;
}
@media (max-width: 550px) {
  .markdown-preview.markdown-preview .galeria_imagenes {
    flex-direction: column;
  }
}
@media (min-width: 550px) {
  .markdown-preview.markdown-preview .galeria_imagenes {
    flex-direction: row;
  }
}
.markdown-preview.markdown-preview table {
  table-layout: auto !important;
  width: fit-content !important;
  max-width: none !important;
  border-collapse: collapse !important;
}
.markdown-preview.markdown-preview .style-normal {
  text-indent: 0.5cm;
  text-align: justify;
}
.markdown-preview.markdown-preview .style-example {
  text-indent: 0cm;
  text-align: justify;
  font-size: small;
}
.markdown-preview.markdown-preview .style-note {
  text-align: justify;
  font-size: x-small;
}
.markdown-preview.markdown-preview .style-title {
  text-indent: 0cm;
  text-align: center;
}
.markdown-preview.markdown-preview .style-list {
  text-indent: 0cm;
  text-align: justify;
}
.markdown-preview.markdown-preview .style-table-content table {
  background-color: #f0f9ff !important;
  border-style: none !important;
  width: 100% !important;
  table-layout: fixed !important;
}
.markdown-preview.markdown-preview .style-table-content th,
.markdown-preview.markdown-preview .style-table-content td {
  border-style: none !important;
  vertical-align: top !important;
}
.markdown-preview.markdown-preview .style-table-content th:first-child,
.markdown-preview.markdown-preview .style-table-content td:first-child {
  width: 200px !important;
}
.markdown-preview.markdown-preview .md-toc {
  background-color: rgba(173, 216, 230, 0.4) !important;
}
.markdown-preview.markdown-preview pre,
.markdown-preview.markdown-preview code {
  page-break-inside: auto !important;
  break-inside: auto !important;
  white-space: pre-wrap;
}

      </style>
      <!-- The content below will be included at the end of the <head> element. --><script type="text/javascript">
  const configureMermaidIconPacks = () => {
    window["mermaid"].registerIconPacks([
      {
        name: "logos",
        loader: () =>
          fetch("https://unpkg.com/@iconify-json/logos@1/icons.json").then(
            (res) => res.json()
          ),
      },
    ]);
  };

  if (document.readyState !== 'loading') {
    configureMermaidIconPacks();
  } else {
    document.addEventListener("DOMContentLoaded", () => {
      configureMermaidIconPacks();
    });
  }
</script></head><body for="html-export">
    
    
      <div class="crossnote markdown-preview  ">
      
<style type="text/css">
.style-normal {
    text-indent: 0.5cm;
    text-align: justify;
}
.style-example {
    text-indent: 0.5cm;
    text-align: justify;
    text-size: small    
}
.style-title {
    text-indent: 0cm;
    text-align: center;    
}
table {
    table-layout: auto !important;
    width: fit-content !important;
    max-width: none !important;
    border-collapse: collapse;
}
</style>
<p><img src="../../../assets/img-BalmisHeader.png" alt="ONU"></p>
<div class="style-title">
<h1 id="u06-linux-ssh">U06 Linux SSH </h1>
</div>
<p>游닃<a href="./linux.ssh.pdf">Descargar PDF</a></p>
<h2 id="칤ndice">칈NDICE </h2>
<div style="background-color: Lightgrey;">

<div class="md-toc">
<details style="padding:0;;padding-left:0px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#servidor-ssh" class="md-toc-link"><p>SERVIDOR SSH</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#instalaci칩n" class="md-toc-link">
            <p>INSTALACI칍N</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#programas-relacionados" class="md-toc-link">
            <p>PROGRAMAS RELACIONADOS</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#archivos-de-configuraci칩n" class="md-toc-link">
            <p>ARCHIVOS DE CONFIGURACI칍N</p>

          </a></div><details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#configuraci칩n-del-servidor-ssh" class="md-toc-link"><p>CONFIGURACI칍N DEL SERVIDOR SSH</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#el-fichero-sshd_config" class="md-toc-link">
            <p>EL FICHERO sshd_config</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#par치metros-de-configuraci칩n-principales" class="md-toc-link">
            <p>PAR츼METROS DE CONFIGURACI칍N PRINCIPALES</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#restricci칩n-del-acceso" class="md-toc-link">
            <p>RESTRICCI칍N DEL ACCESO</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#confiuraciones-personalizadas" class="md-toc-link">
            <p>CONFIURACIONES PERSONALIZADAS</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#restricciones-temporales" class="md-toc-link">
            <p>RESTRICCIONES TEMPORALES</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#otras-directivas" class="md-toc-link">
            <p>OTRAS DIRECTIVAS</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#directivas-de-sftp" class="md-toc-link">
            <p>DIRECTIVAS DE SFTP</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:24px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#prueba-de-la-configuraci칩n" class="md-toc-link"><p>PRUEBA DE LA CONFIGURACI칍N</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#validaciones-del-fichero-de-configuraci칩n" class="md-toc-link">
            <p>VALIDACIONES DEL FICHERO DE CONFIGURACI칍N</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#validaciones-de-restricciones-temporales" class="md-toc-link">
            <p>VALIDACIONES DE RESTRICCIONES TEMPORALES</p>

          </a></div>
        </div>
      </details>
    <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#logging-y-auditor칤a" class="md-toc-link">
            <p>LOGGING Y AUDITOR칈A</p>

          </a></div>
        </div>
      </details>
    <details style="padding:0;;padding-left:0px;" open="">
        <summary class="md-toc-link-wrapper">
          <a href="#cliente-ssh" class="md-toc-link"><p>CLIENTE SSH</p>
</a>
          </summary>
        <div>
          <div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#instalaci칩n-1" class="md-toc-link">
            <p>INSTALACI칍N</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#programas-disponibles" class="md-toc-link">
            <p>PROGRAMAS DISPONIBLES</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#archivos-de-configuraci칩n-del-cliente" class="md-toc-link">
            <p>ARCHIVOS DE CONFIGURACI칍N DEL CLIENTE</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#conexi칩n-y-desconexi칩n" class="md-toc-link">
            <p>CONEXI칍N Y DESCONEXI칍N</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#generaci칩n-de-claves-p칰blicas-y-privadas" class="md-toc-link">
            <p>GENERACI칍N DE CLAVES P칔BLICAS Y PRIVADAS</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#uso-del-agente-de-claves" class="md-toc-link">
            <p>USO DEL AGENTE DE CLAVES</p>

          </a></div><div class="md-toc-link-wrapper" style="padding:0;;display:list-item;list-style:square;margin-left:42px">
          <a href="#copiar-ficheros-con-scp-y-sftp" class="md-toc-link">
            <p>COPIAR FICHEROS CON SCP y SFTP</p>

          </a></div>
        </div>
      </details>
    
</div>
</div>
<div style="page-break-after:always;"></div>
<h2 id="servidor-ssh">SERVIDOR SSH </h2>
<h3 id="instalaci칩n">INSTALACI칍N </h3>
<p>Dependiendo de la distribuci칩n GNU/Linux que se utilice, el proceso de instalaci칩n del servidor puede variar.<br>
Para los sistemas Debian y derivados (Ubuntu, Linux Mint, etc.) se utiliza el sistema de gesti칩n de paquetes <code>apt</code>, mientras que en Alpine Linux se emplea <code>apk</code>.</p>
<p>En Debian, el paquete que proporciona el servidor SSH se llama <code>openssh-server</code> y el que proporciona el cliente se llama <code>openssh-client</code>. El paquete <code>openssh-server</code> depende del paquete <code>openssh-client</code> y, por lo tanto, al instalar el servidor se instalar치 autom치ticamente el cliente. Existe un metapaquete llamado <code>ssh</code> que instala ambos paquetes. En este caso instalar ssh u openssh-server es equivalente, ya que ambos instalar치n el servidor y el cliente.</p>
<p>En Alpine Linux, el paquete que proporciona el servidor SSH se llama <code>openssh-server</code> y el que proporciona el cliente se llama <code>openssh-client</code>. Tambi칠n tenemos el metapaquete que instala ambos y que se llama <code>openssh</code>.</p>
<div class="row">
<div class="col-sm-6 my-auto">
<p><strong>Distribuci칩n Debian</strong></p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code><span class="token function">apt</span> update
<span class="token function">apt</span> <span class="token function">install</span> openssh-server
</code></pre></div>
<div class="col-sm-6 my-auto">
<p><strong>Distribuci칩n Alpine</strong></p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>apk update
apk <span class="token function">add</span> openssh-server
</code></pre></div>
</div>
<p>En Debian, tras la instalaci칩n se crea y activa el servicio <code>ssh</code> (o <code>sshd</code>) gestionado por <code>systemd</code>, y se generan las claves de host en <code>/etc/ssh/</code>. Sin embargo, en Alpine Linux el proceso es diferente: tras instalar el paquete <code>openssh-server</code> no se genera autom치ticamente el servicio ni las claves de host. Por lo tanto, en Alpine Linux es necesario generar manualmente las claves de host con el comando <code>ssh-keygen</code> y luego iniciar el servicio <code>sshd</code> utilizando <code>rc-service</code>. Para hacer que el servicio <code>sshd</code> se inicie autom치ticamente al arrancar el sistema en Alpine Linux, se debe habilitar con <code>rc-update</code>.</p>
<div class="admonition example">
<p class="admonition-title">Instalaci칩n SSH</p>
<p>En Debian, el proceso de instalaci칩n del servidor SSH se realiza con el siguiente comando:</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code><span class="token function">apt</span> <span class="token function">install</span> openssh-server
</code></pre><p>En Alpine Linux, el proceso de instalaci칩n es el siguiente:</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>apk <span class="token function">add</span> openssh-server
ssh-keygen <span class="token parameter variable">-A</span>
rc-service sshd start
rc-update <span class="token function">add</span> sshd default
</code></pre><p>La 칰ltima l칤nea asegura que el servicio <code>sshd</code> se inicie autom치ticamente al arrancar el sistema.</p>
</div>
<h3 id="programas-relacionados">PROGRAMAS RELACIONADOS </h3>
<p>Cuando instalamos el servidor OpenSSH en un sistema Debian (o derivados) no solo se pone en marcha el servicio, sino que se a침aden varias utilidades que cubren las tareas habituales relacionadas con SSH: ofrecer el servicio, conectarse a otros equipos, transferir ficheros y gestionar las claves de autenticaci칩n.</p>
<ul>
<li>
<p><strong>sshd (servidor SSH).</strong> Es el servicio o demonio que queda en segundo plano escuchando normalmente en el puerto 22 a la espera de conexiones entrantes. Se administra como cualquier otro servicio del sistema (por ejemplo, con <code>systemctl start ssh</code>, <code>systemctl stop ssh</code>, etc.) y se configura principalmente a trav칠s del fichero <code>/etc/ssh/sshd_config</code>.</p>
</li>
<li>
<p><strong>ssh (cliente SSH).</strong> Es el programa que se utiliza para conectarse de forma remota a otro equipo. Permite tanto abrir una sesi칩n interactiva (tipo consola) como ejecutar un 칰nico comando en la m치quina remota, recibiendo la salida en nuestra terminal local.</p>
</li>
<li>
<p><strong>scp (copia de archivos sobre SSH).</strong> Proporciona una forma sencilla de copiar archivos y directorios entre el equipo local y el remoto utilizando SSH como canal cifrado. La sintaxis es similar a la de <code>cp</code>, pero indicando el equipo remoto con la forma <code>usuario@host:ruta</code>.</p>
</li>
<li>
<p><strong>sftp (SFTP: "FTP sobre SSH").</strong> Ofrece un cliente interactivo de transferencia de archivos, similar a un cliente FTP tradicional, pero utilizando SSH como transporte seguro. Desde este entorno se pueden listar directorios, subir y descargar archivos, borrar, renombrar, etc., con comandos como <code>ls</code>, <code>cd</code>, <code>get</code> o <code>put</code>.</p>
</li>
<li>
<p><strong>ssh-keygen (creaci칩n y gesti칩n de claves).</strong> Se emplea para crear y administrar pares de claves p칰blica/privada que permiten la autenticaci칩n sin contrase침a. Tambi칠n genera las claves de host que identifican al propio servidor (las que se almacenan en <code>/etc/ssh/ssh_host_*</code>). Permite elegir el tipo de clave (<code>rsa</code>, <code>ed25519</code>, etc.), su tama침o, la ruta de almacenamiento y la frase secreta que protege la clave privada.</p>
</li>
<li>
<p><strong>ssh-agent (agente de claves en memoria).</strong> Es un proceso auxiliar que guarda en memoria las claves privadas descifradas mientras dura la sesi칩n de trabajo. De esta forma, el usuario introduce la frase secreta de la clave una sola vez y, a partir de ah칤, las conexiones <code>ssh</code>, <code>scp</code> o <code>sftp</code> pueden utilizarla sin volver a pedirla.</p>
</li>
<li>
<p><strong>ssh-add (gesti칩n de claves del agente).</strong> Es la herramienta que se utiliza para a침adir o eliminar claves privadas gestionadas por <code>ssh-agent</code>. Por ejemplo, <code>ssh-add ~/.ssh/id_ed25519</code> carga en el agente la clave privada indicada tras introducir su frase secreta.</p>
</li>
<li>
<p><strong>ssh-keyscan (recogida de claves p칰blicas de servidores).</strong> Permite obtener de forma r치pida las claves p칰blicas de host de uno o varios servidores remotos. Resulta 칰til para poblar o revisar el fichero <code>known_hosts</code> sin necesidad de establecer una conexi칩n interactiva completa.</p>
</li>
</ul>
<p>Adem치s de estos programas principales, la instalaci칩n de OpenSSH incorpora otras utilidades auxiliares (como <code>ssh-askpass</code>, <code>ssh-keysign</code>, etc.) que normalmente no se ejecutan de manera directa, sino que son invocadas internamente por el propio sistema en escenarios de autenticaci칩n m치s avanzados.</p>
<p>Para publicar claves en un servidor y poder usar autenticaci칩n basada en claves, lo m치s sencillo es utilizar <code>ssh-copy-id</code>. En caso de que no est칠 disponible, siempre se puede recurrir a <code>scp</code> y editar manualmente el fichero <code>authorized_keys</code> del usuario remoto.</p>
<h3 id="archivos-de-configuraci칩n">ARCHIVOS DE CONFIGURACI칍N </h3>
<p>La instalaci칩n del servidor crea y utiliza una serie de ficheros de configuraci칩n y claves que determinan c칩mo se comporta <code>sshd</code> y qui칠n puede conectarse. En la mayor칤a de sistemas GNU/Linux, los m치s relevantes son:</p>
<ul>
<li><code>/etc/ssh/sshd_config</code><br>
Archivo de configuraci칩n principal del servidor SSH (<code>sshd</code>), donde se definen aspectos como el puerto de escucha, los m칠todos de autenticaci칩n permitidos o las directivas de acceso de los usuarios.</li>
<li><code>/etc/ssh/ssh_host_*_key</code><br>
Conjunto de claves privadas de host utilizadas para identificar de forma 칰nica al servidor frente a los clientes.</li>
<li><code>/home/&lt;usuario&gt;/.ssh/authorized_keys</code><br>
Fichero que contiene las claves p칰blicas autorizadas para la conexi칩n sin contrase침a de un usuario concreto.</li>
</ul>
<h3 id="configuraci칩n-del-servidor-ssh">CONFIGURACI칍N DEL SERVIDOR SSH </h3>
<p>Una vez instalado el servidor y conocidos los ficheros principales, la mayor parte de la configuraci칩n se realiza en <code>/etc/ssh/sshd_config</code>. En este archivo se definen el puerto, los m칠todos de autenticaci칩n permitidos, qu칠 usuarios pueden entrar, desde d칩nde, etc.</p>
<h4 id="el-fichero-sshd_config">EL FICHERO sshd_config </h4>
<p>Tiene las siguientes caracter칤sticas principales:</p>
<ul>
<li>
<p>El fichero por defecto suele encontrarse en <code>/etc/ssh/sshd_config</code>.</p>
</li>
<li>
<p>Para editarlo se necesita ser administrador.</p>
</li>
<li>
<p>Tras modificarlo, es importante <strong>comprobar la sintaxis</strong> antes de recargar el servicio:</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>sshd <span class="token parameter variable">-t</span>
</code></pre></li>
</ul>
<p>Si no hay errores, se puede recargar el servicio para aplicar los cambios sin cortar las conexiones activas:</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>systemctl reload <span class="token function">ssh</span>
</code></pre><p>Es posible utilizar sshd en lugar de ssh, dependiendo de la distribuci칩n, por lo que el comando ser칤a <code>systemctl reload sshd</code> (alias de <code>ssh</code>).</p>
<p>El fichero <code>sshd_config</code> es el coraz칩n de la configuraci칩n del servidor SSH, y en 칠l se pueden ajustar una gran cantidad de par치metros que afectan a la seguridad, el rendimiento y el comportamiento general del servicio. En 칠l se definen par치metros de configuraci칩n generales del servidor y reglas aplicables a todos los usuarios, reglas que permiten o deniegan el acceso a ciertos usuarios o grupos y reglas especificas para ciertos usuarios, grupos o ubicaciones (bloques <code>Match</code>), entre otras muchas opciones.</p>
<p>A grosso modo, el fichero <code>sshd_config</code> se puede dividir en dos grandes bloques: <strong>la configuraci칩n global</strong>, que se aplica a todas las conexiones, y <strong>los bloques <code>Match</code></strong>, que permiten definir excepciones o reglas espec칤ficas para ciertos usuarios, grupos o ubicaciones. Los bloques <code>Match</code> tienen que colocarse al final del fichero, despu칠s de las directivas globales y sobreescriben o ampl칤an la configuraci칩n general mientras se cumplan las condiciones indicadas en el bloque.</p>
<p>Los par치metros de configuraci칩n se definen mediante directivas, que son palabras clave seguidas de uno o m치s argumentos. Por ejemplo, la directiva <code>Port</code> seguida de un n칰mero indica el puerto en el que el servidor SSH escuchar치 las conexiones entrantes. La directiva <code>PasswordAuthentication</code> seguida de <code>yes</code> o <code>no</code> indica si se permite o proh칤be la autenticaci칩n mediante contrase침a.<br>
Todas las directivas tienen un valor por defecto. Por convenio, en el fichero <code>sshd_config</code> se suelen incluir comentarios que indican el valor por defecto de cada directiva, aunque es recomendable incluir las directivas que se quieran configurar expl칤citamente, aunque sea para dejar claro que se est치 usando el valor por defecto, ya que esto mejora la legibilidad y facilita la revisi칩n de la configuraci칩n.<br>
El orden de las directivas es importante, ya que si una directiva se define varias veces, la primera definici칩n ser치 la que se aplique, a no ser que se coloque dentro de un bloque <code>Match</code>, en cuyo caso la directiva dentro del bloque <code>Match</code> sobrescribir치 a la directiva global mientras se cumplan las condiciones del bloque.</p>
<p>SSH permite realizar la configuraci칩n de forma modular, ya que es posible incluir otros ficheros de configuraci칩n mediante la directiva <code>Include</code>. Esto permite organizar la configuraci칩n en varios ficheros, por ejemplo, uno para la configuraci칩n global y otros para reglas espec칤ficas de usuarios o grupos. Los ficheros incluidos se procesan en el orden en que aparecen en el fichero principal, y se suelen colocar en la carpeta <code>/etc/ssh/sshd_config.d/</code> para mantener una estructura ordenada.</p>
<p><strong>Bloques Match</strong><br>
Los bloques <code>Match</code> permiten definir <em>excepciones controladas</em> sobre la configuraci칩n general: las directivas que se coloquen dentro de un bloque <code>Match</code> solo se aplican si se cumplen unas condiciones (por ejemplo, cierto usuario, grupo, direcci칩n IP de origen, puerto de destino, etc.). Gracias a esto, es posible construir perfiles de seguridad distintos dentro del mismo servidor: forzar el uso de claves a los administradores pero permitir contrase침a a determinados alumnos, impedir que algunos grupos creen t칰neles SSH, forzar un entorno SFTP sin shell para ciertos usuarios, aplicar pol칤ticas diferentes seg칰n la red desde la que se conectan, etc.</p>
<p>La sintaxis de un bloque <code>Match</code> es la siguiente:</p>
<pre data-role="codeBlock" data-info="text" class="language-text text"><code>Match &lt;criterio1&gt; &lt;valor1&gt; &lt;criterio2&gt; &lt;valor2&gt; ...
      &lt;directivaA&gt;
      &lt;directivaB&gt;
      ...
</code></pre><p>En un bloque <code>Match</code> el significado de <code>&lt;criterio&gt;</code> puede ser <code>User</code>, <code>Group</code>, <code>Address</code>, <code>Host</code>, etc., y <code>&lt;valor&gt;</code> es cualquier valor v치lido para ese criterio (por ejemplo, un nombre de usuario, grupo o direcci칩n IP). El significado de <code>&lt;directiva&gt;</code> es el mismo que en la configuraci칩n global, pero solo se aplicar치 a las conexiones que cumplan los criterios del bloque <code>Match</code>.</p>
<p>Las directivas dentro de un bloque <code>Match</code> <strong>sobrescriben</strong> las directivas globales mientras se cumplan las condiciones indicadas. Por ejemplo, si a nivel global se permite la autenticaci칩n por contrase침a, pero dentro de un bloque <code>Match User admin1</code> se pone <code>PasswordAuthentication no</code>, entonces el usuario <code>admin1</code> solo podr치 autenticarse mediante claves, mientras que el resto de usuarios podr치n usar contrase침a.</p>
<h4 id="par치metros-de-configuraci칩n-principales">PAR츼METROS DE CONFIGURACI칍N PRINCIPALES </h4>
<p>Algunas directivas m칤nimas que conviene revisar en cualquier servidor SSH son las siguientes:</p>
<ul>
<li><code>Port</code><br>
Puerto en el que escucha el servicio. Por defecto es <code>22</code>.</li>
<li><code>ListenAddress</code><br>
Direcci칩n IP en la que se escuchan conexiones (por ejemplo, <code>0.0.0.0</code> para todas las interfaces, o una IP concreta).</li>
<li><code>Protocol</code><br>
En versiones modernas debe ser <code>2</code>. El protocolo 1 est치 obsoleto.</li>
<li><code>PermitRootLogin</code><br>
Controla si el usuario <code>root</code> puede entrar directamente por SSH. Es recomendable ponerlo a <code>no</code>.</li>
<li><code>PasswordAuthentication</code><br>
Permite (yes) o proh칤be (no) la autenticaci칩n mediante contrase침a. En entornos seguros se suele desactivar cuando ya se usan claves.</li>
<li><code>PubkeyAuthentication</code><br>
Activa/desactiva la autenticaci칩n mediante claves p칰blicas. Lo normal es que est칠 en <code>yes</code>.</li>
<li><code>PermitEmptyPasswords</code><br>
Si est치 en <code>yes</code>, permitir칤a contrase침as vac칤as, algo totalmente desaconsejado. Debe estar en <code>no</code>.</li>
<li><code>MaxAuthTries</code><br>
N칰mero m치ximo de intentos de autenticaci칩n antes de cerrar la conexi칩n.</li>
</ul>
<div class="admonition example">
<p class="admonition-title">Configuraci칩n b치sica de sshd_config</p>
<p>Este es un ejemplo de fragmento sencillo y razonable.</p>
<pre data-role="codeBlock" data-info="text" class="language-text text"><code>Port 22
Protocol 2
PermitRootLogin no
PasswordAuthentication yes
PubkeyAuthentication yes
PermitEmptyPasswords no
MaxAuthTries 3
</code></pre><p>En este caso se permite la autenticaci칩n tanto por contrase침a como por claves, pero se proh칤be el acceso directo al usuario <code>root</code> y se limita el n칰mero de intentos fallidos a 3.</p>
</div>
<p>En un servidor ya en producci칩n se suele avanzar hacia configuraciones m치s estrictas (por ejemplo, <code>PasswordAuthentication no</code> para obligar al uso de claves).</p>
<h4 id="restricci칩n-del-acceso">RESTRICCI칍N DEL ACCESO </h4>
<p>Las directivas <code>AllowUsers</code>, <code>DenyUsers</code>, <code>AllowGroups</code> y <code>DenyGroups</code> son las que se utilizan para controlar qui칠n puede autenticarse en el servidor SSH. Su colocaci칩n en el fichero es indiferente ya que siempre se evaluan siguiendo la siguiente secuencia:</p>
<p>DenyUsers  AllowUsers  DenyGroups  AllowGroups</p>
<p><strong>AllowUsers</strong><br>
Permite el acceso solo a los usuarios listados. Si se especifica esta directiva, solo los usuarios mencionados podr치n autenticarse (si no hay otras directivas que lo impidan), y el resto ser치n denegados por defecto. Sintaxis:</p>
<pre data-role="codeBlock" data-info="text" class="language-text text"><code>AllowUsers usuario1[@sitio1] usuario2[@sitio2] ...
</code></pre><p>Como vemos, es posible especificar un usuario con el formato <code>usuario@sitio</code>, lo que significa que ese usuario solo podr치 autenticarse desde ese <em>sitio</em> especifico. El sitio puede ser una ip, una red, o un nombre DNS de host.췈</p>
<div class="admonition example">
<p class="admonition-title">Restricciones por usuario (AllowUsers)</p>
<p>Permitir el acceso solo a los usuarios <code>admin1</code> y <code>admin2</code> desde cualquier host y a <code>operadorEsp</code> desde la red 192.168.1.0/24, denegando el acceso a cualquier otro usuario.</p>
<pre data-role="codeBlock" data-info="text" class="language-text text"><code>AllowUsers admin1 admin2 operadorEsp@192.168.1.0/24
</code></pre><p>Todo lo que no est칠 expl칤citamente permitido en <code>AllowUsers</code> se deniega por defecto.</p>
</div>
<p><strong>DenyUsers</strong><br>
Deniega el acceso a los usuarios listados. Si se especifica esta directiva, los usuarios mencionados no podr치n autenticarse, mientras que el resto de usuarios s칤 podr치n hacerlo (si no hay otras restricciones). Sintaxis:</p>
<pre data-role="codeBlock" data-info="text" class="language-text text"><code>DenyUsers usuario1[@sitio1] usuario2[@sitio2] ...
</code></pre><div class="admonition example">
<p class="admonition-title">Restricciones por usuario (DenyUsers)</p>
<p>Denegar el acceso al usuario <code>invitado</code> desde cualquier host.</p>
<pre data-role="codeBlock" data-info="text" class="language-text text"><code>DenyUsers invitado
</code></pre><p>Lo que no se deniegue expl칤citamente en <code>DenyUsers</code> se permitir치.</p>
</div>
<p>Al igual que en <code>AllowUsers</code>, es posible especificar un usuario con el formato <code>usuario@sitio</code>, lo que significa que ese usuario solo podr치 autenticarse desde ese <em>sitio</em> especifico. El sitio puede ser una ip, una red, o un nombre DNS de host.</p>
<p><strong>AllowGroups</strong><br>
Permite el acceso solo a los usuarios que pertenezcan a los grupos listados. No se permite especificar ubicaciones espec칤ficas para los grupos como se hace con los usuarios. Sintaxis:</p>
<pre data-role="codeBlock" data-info="text" class="language-text text"><code>AllowGroups grupo1 grupo2 ...
</code></pre><p>Se les vetar치 el acceso a los usuarios que no pertenezcan a ninguno de los grupos listados, mientras que los usuarios que s칤 pertenezcan a alguno de esos grupos podr치n autenticarse (si no hay otras restricciones).</p>
<p><strong>DenyGroups</strong><br>
Deniega el acceso a los usuarios que pertenezcan a los grupos listados. Al igual que <code>AllowGroups</code>, no se permite especificar ubicaciones espec칤ficas para los grupos. Sintaxis:</p>
<pre data-role="codeBlock" data-info="text" class="language-text text"><code>DenyGroups grupo1 grupo2 ...
</code></pre><p>Se les denegar치 el acceso a los usuarios que pertenezcan a alguno de los grupos listados, mientras que los usuarios que no pertenzcan a ninguno de esos grupos podr치n autenticarse (si no hay otras restricciones).</p>
<p>Es recomendable utilizar s칩lo el <em>usuario</em> sin especificar el <em>sitio</em> en las directivas <code>AllowUsers</code> y <code>DenyUsers</code>; posteriormente en cl치usulas <code>Match</code> se pueden a침adir excepciones para ciertos usuarios desde ciertas ubicaciones.</p>
<p><strong>Evaluaci칩n de la configuraci칩n de acceso</strong><br>
No es conveniente mezclar estas directivas de control de acceso, ya que pueden generar confusi칩n y producir resultados inesperados. El siguiente ejemplo muestra una configuraci칩n conflictiva:</p>
<div class="admonition example">
<p class="admonition-title">Configuraci칩n conflictiva</p>
<p>La configuraci칩n mostrada, aparentemente permite el acceso a los usuarios <code>u1</code>, <code>u2</code> y a los pertenecientes al grupo <code>grp3</code>.</p>
<pre data-role="codeBlock" data-info="text" class="language-text text"><code>AllowUsers u1 u2
AllowGroups grp3
</code></pre><p>Sin embargo si intentamos conectar con un usuario <code>u3</code> que pertenece al grupo <code>grp3</code>, la conexi칩n se denegar치, ya que el usuario <code>u3</code> no est치 incluido en <code>AllowUsers</code>, y por lo tanto autom치ticamente se le deniega el acceso. Ya no se eval칰a <code>AllowGroups</code>.</p>
</div>
<p>Para entender el funcionamiento del control de acceso, es importante conocer que sucede se eval칰a cada una de estas directivas.</p>
<p>El siguiente diagrama de estados muestra el proceso de evaluaci칩n de las directivas de control de acceso:</p>
<p><img src="./assets/Deny-Allow-SSH.svg" alt="Diagrama Estados Control Acceso"></p>
<p>En el diagrama <em>hit</em> indica que el usuario satisface la regla, mientras que <em>miss</em> indica que no la satisface. Para entender su funcionamiemto vamos a suponer que existen unas reglas ficticias <em>AlloUsers all</em> y <em>AllowGroups all</em>, que las satisfacen todos los usuarios y todos los grupos respectivamente. An치logamente, supondremos que existe tambi칠n <em>DenyUsers none</em> y <em>DenyGroups none</em> que no ser칤an satisfechas por ning칰n usuario ni grupo respectivamente.<br>
Vamos a analizar el ejemplo conflictivo mostrado anteriormente:</p>
<div class="admonition example">
<p class="admonition-title">Evaluaci칩n del acceso</p>
<p>Veamos como se eval칰a la siguiente configuraci칩n cuando el usuario <code>u3</code>, perteneciente al grupo <code>grp3</code>, intenta acceder al servidor SSH.</p>
<pre data-role="codeBlock" data-info="text" class="language-text text"><code>AllowUsers u1 u2
AllowGroups grp3
</code></pre><p>El modelo equivalente con las reglas ficticias ser칤a el siguiente:</p>
<pre data-role="codeBlock" data-info="text" class="language-text text"><code>DenyUsers none
AllowUsers u1 u2
DenyGroups none
AllowGroups grp3
</code></pre><p>El usuario <code>u3</code> no satisface la regla de la etapa <em>DenyUsers</em> (miss), y por lo tanto pasa a la siguiente etapa. El usuario <code>u3</code> no satisface la regla de la etapa <em>AllowUsers</em> (miss), y por lo tanto se le deniega el acceso; no pasa a la siguiente etapa.</p>
</div>
<p>Veamos otro ejemplo un poco m치s rebuscado.</p>
<div class="admonition example">
<p class="admonition-title">Evaluaci칩n del acceso</p>
<p>Analicemos la siguiente configuraci칩n cuando el usuario <code>u1</code>, perteneciente al grupo <code>grp1</code>, intenta acceder al servidor SSH.</p>
<pre data-role="codeBlock" data-info="text" class="language-text text"><code>AllowUsers u1 u2
DenyGroups grp3
AllowGroups grp1 grp4
</code></pre><p>El modelo equivalente con las reglas ficticias ser칤a el siguiente:</p>
<pre data-role="codeBlock" data-info="text" class="language-text text"><code>DenyUsers none
AllowUsers u1 u2
DenyGroups grp3
AllowGroups grp1 grp4
</code></pre><p>El usuario <code>u1</code> no satisface la regla de la etapa <em>DenyUsers</em> (miss), y por lo tanto pasa a la siguiente etapa. El usuario <code>u1</code> satisface la regla de la etapa <em>AllowUsers</em> (hit), y contin칰a con la siguiente etapa. El usuario no satisface la regla de la etapa <em>DenyGroups</em> (miss) y llega a la etapa final <em>AllowGroups</em>. El usuario <code>u1</code> pertenece al grupo <code>grp1</code> (hit), y por lo tanto se le permite el acceso.</p>
</div>
<p>Como regla general se recomienda no mezclar estas directivas de control de acceso siempre que sea posible y usar, preferentemente, reglas grupales (AllowGroups y DenyGroups) en lugar de reglas individuales (AllowUsers y DenyUsers), ya que esto suele ser m치s sencillo de gestionar y menos propenso a errores. Siempre es mejor utilizar reglas de tipo Allow ya que de esta manera establecemos una pol칤tica de denegaci칩n por defecto, lo que suele ser m치s seguro y es lo que se utiliza en producci칩n.</p>
<h4 id="confiuraciones-personalizadas">CONFIURACIONES PERSONALIZADAS </h4>
<p>Mediante bloques <code>Match</code> es posible aplicar configuraciones personalizadas para ciertos usuarios, grupos o ubicaciones. Esto permite adaptar el comportamiento del servidor SSH a las necesidades espec칤ficas de cada caso, aplicando pol칤ticas de seguridad m치s estrictas para algunos usuarios o permitiendo ciertas excepciones para otros.</p>
<p>Con <code>Match User</code> o <code>Match Group</code> se pueden aplicar configuraciones espec칤ficas a ciertos usuarios o grupos.</p>
<div class="admonition example">
<p class="admonition-title">Configuraciones personalizadas por usuario</p>
<p>Permitir que el usuario <code>invitado</code> solo pueda autenticarse mediante contrase침a, mientras que el resto de usuarios pueden usar tanto contrase침a como claves.</p>
<pre data-role="codeBlock" data-info="text" class="language-text text"><code># Configuraci칩n global: todos los usuarios pueden usar contrase침a o claves
PasswordAuthentication yes
PubkeyAuthentication yes

# Para el usuario invitado se proh칤be la autenticaci칩n por claves
Match User invitado
      PubkeyAuthentication no
</code></pre><p>Realmente, no es necesario poner <code>PasswordAuthentication yes</code> ni <code>PubkeyAuthentication yes</code> en la configuraci칩n global, ya que esos son los valores por defecto.</p>
</div>
<p>Con la directiva<code>Match Address</code> se permite definir una regla que regule el acceso desde una ubicaci칩n concreta. Esto es especialmente 칰til para aplicar pol칤ticas de seguridad diferentes seg칰n la red desde la que se conecten los usuarios. Por ejemplo, se pueden permitir opciones m치s relajadas para conexiones que llegan desde la red interna de la organizaci칩n, mientras que se endurecen las opciones para conexiones que llegan desde fuera de esa red.</p>
<div class="admonition example">
<p class="admonition-title">Configuraciones personalizadas por ubicaci칩n</p>
<p>El sguiente ejemplo combina <code>Match Group</code> y <code>Match Address</code> para denegar el acceso a los usuarios del grupo <code>invitados</code> desde la red <code>192.168.5.0/25</code>.</p>
<pre data-role="codeBlock" data-info="text" class="language-text text"><code># Regla global: dejamos pasar a los invitados
AllowGroups invitados ...

# Desde la red interna se permite adem치s el usuario invitado
Match Group invitados Address 192.168.5.0/25
      PasswordAuthentication no
      PubkeyAuthentication no
</code></pre><p>En principio, se permite el acceso a los usuarios del grupo <code>invitados</code>, pero luego la cl치usula <code>Match</code> realmente no les deja validarse de ninguna forma, si provienen de la red <code>192.168.5.0/25</code>.</p>
</div>
<h4 id="restricciones-temporales">RESTRICCIONES TEMPORALES </h4>
<p>SSH no provee de forma nativa mecanismos para restringir el acceso en funci칩n de horarios, d칤as de la semana o fechas concretas. Sin embargo, se puede <strong>integrar con PAM</strong> (Pluggable Authentication Modules) para aplicar este tipo de restricciones.<br>
Para habilitar la integraci칩n con PAM, es necesario que en <code>sshd_config</code> est칠 presente la siguiente directiva:</p>
<pre data-role="codeBlock" data-info="text" class="language-text text"><code>UsePAM yes
</code></pre><p>La integraci칩n con PAM permite aplicar pol칤ticas de autenticaci칩n m치s complejas y flexibles, ya que PAM es un sistema modular que puede utilizar distintos m칩dulos para controlar el acceso.<br>
En el fichero <code>/etc/pam.d/sshd</code> se pueden configurar m칩dulos como <strong>pam_time</strong> para restringir el acceso a ciertas horas o d칤as, o pam_tally2 para bloquear cuentas tras varios intentos fallidos. Tambi칠n es posible integrar PAM con sistemas de autenticaci칩n externos (LDAP, RADIUS, etc.) para centralizar la gesti칩n de usuarios y pol칤ticas de acceso.<br>
Una vez activada la integraci칩n con PAM, tenemos que ajustar el fichero <code>/etc/pam.d/sshd</code> para incluir el modulo pam_time. Por ello, a침adimos la siguiente l칤nea al final del fichero:</p>
<pre data-role="codeBlock" data-info="text" class="language-text text"><code>account required pam_time.so
</code></pre><p>A continuaci칩n, se pueden definir las reglas de acceso temporal en el fichero <code>/etc/security/time.conf</code>. Las reglas de este fichero tienen la siguiente sintaxis:</p>
<pre data-role="codeBlock" data-info="text" class="language-text text"><code>servicio;ttys;usuarios;horarios
</code></pre><p>Donde:</p>
<ul>
<li><code>servicio</code>: nombre del servicio al que se aplica la regla (en este caso, <code>sshd</code>).</li>
<li><code>ttys</code>: terminales a las que se aplica la regla (por ejemplo, <code>*</code> para todas).</li>
<li><code>usuarios</code>: usuarios o grupos a los que se aplica la regla (por ejemplo, <code>*</code> para todos).</li>
<li><code>horarios</code>: especificaci칩n de los d칤as y horas en los que se permite o deniega el acceso. El formato de los horarios es bastante flexible y permite definir rangos de horas, d칤as de la semana, meses, etc.</li>
</ul>
<div class="admonition example">
<p class="admonition-title">Restricciones temporales</p>
<p>Permitir el acceso al servicio SSH solo de lunes a viernes de 8:00 a 14:00 horas y de 17:00 a 19:00 horas.</p>
<pre data-role="codeBlock" data-info="text" class="language-text text"><code>sshd;*;*;Wk0800-1400,Wk1700-1900
</code></pre><p>En este caso, <code>sshd</code> indica que la regla se aplica al servicio SSH, <code>*</code> significa que se aplica a todos los usuarios y a todas las terminales, y <code>Wk0800-1400,Wk1700-1900</code> especifica que el acceso solo est치 permitido de lunes a viernes (Wk) entre las 8:00 y las 14:00 horas, y tambi칠n entre las 17:00 y las 19:00 horas.</p>
</div>
<p>Para m치s informaci칩n sobre la configuraci칩n de PAM y el m칩dulo <strong>pam_time</strong>, se puede consultar la documentaci칩n anexa del framework PAM, as칤 como las p치ginas del manual (<code>man pam_time</code> y <code>man time.conf</code>) o la documentaci칩n oficial de PAM.</p>
<h4 id="otras-directivas">OTRAS DIRECTIVAS </h4>
<p>Adem치s de las directivas anteriores, el manual de <code>sshd_config</code> recoge muchas otras opciones interesantes. Algunas de las m치s habituales son:</p>
<ul>
<li><code>LoginGraceTime</code><br>
Tiempo m치ximo que tiene el cliente para autenticarse antes de que se cierre la conexi칩n (por ejemplo, <code>30s</code>). El valor por defecto es <code>120</code> segundos y, si se pone a <code>0</code>, no habr치 l칤mite de tiempo.</li>
<li><code>ClientAliveInterval</code> y <code>ClientAliveCountMax</code><br>
Sirven para detectar clientes que se han quedado colgados y cerrar sesiones inactivas: cada <code>ClientAliveInterval</code> segundos el servidor env칤a un mensaje y, si tras <code>ClientAliveCountMax</code> intentos no obtiene respuesta, cierra la sesi칩n.</li>
<li><code>AllowTcpForwarding</code>, <code>PermitOpen</code>, <code>X11Forwarding</code><br>
Controlan si se permite crear t칰neles de puertos o reenv칤o de X11. Es frecuente desactivarlos para usuarios con permisos limitados.</li>
<li><code>Banner</code> y <code>PrintMotd</code><br>
Permiten mostrar mensajes al usuario (por ejemplo, avisos legales o normas de uso) antes o despu칠s de autenticarse.</li>
</ul>
<div class="admonition example">
<p class="admonition-title">Otras directivas</p>
<p>El siguiente ejemplo muestra una configuraci칩n que limita el tiempo de autenticaci칩n a 30 segundos, cierra sesiones inactivas tras 5 minutos sin respuesta, proh칤be el reenv칤o de puertos y muestra un banner de bienvenida.</p>
<pre data-role="codeBlock" data-info="text" class="language-text text"><code>LoginGraceTime 30s
ClientAliveInterval 60
ClientAliveCountMax 5
AllowTcpForwarding no
X11Forwarding no
Banner /etc/issue.net
PrintMotd yes
</code></pre><p>El contenido del fichero <code>/etc/issue.net</code> podr칤a ser algo como:</p>
<pre data-role="codeBlock" data-info="text" class="language-text text"><code>*********************************************************************
*                                                                   *
*   Bienvenido al servidor SSH del IES Doctor Balmis.               *
*   El acceso a este sistema es restringido a usuarios autorizados. *
*   Cualquier actividad ser치 monitorizada y registrada.             *
*   Si no eres un usuario autorizado, descon칠ctate inmediatamente.  *
*                                                                   *
*********************************************************************
</code></pre></div>
<p>En cuanto a la parte criptogr치fica, OpenSSH soporta distintos algoritmos de cifrado, integridad y negociaci칩n de clave. Normalmente las versiones actuales ya traen una selecci칩n segura por defecto, pero se pueden ajustar mediante:</p>
<ul>
<li><code>Ciphers</code>  lista de algoritmos de cifrado permitidos.</li>
<li><code>MACs</code>  algoritmos de integridad (Message Authentication Codes).</li>
<li><code>KexAlgorithms</code>  algoritmos de intercambio de claves.</li>
</ul>
<p>En un entorno de aula no suele ser necesario modificar estos par치metros, pero es importante saber que existen para poder <strong>deshabilitar algoritmos antiguos</strong> si alguna gu칤a de seguridad lo exige.</p>
<h4 id="directivas-de-sftp">DIRECTIVAS DE SFTP </h4>
<p>SSH no solo sirve para abrir sesiones de consola remota, sino que tambi칠n puede ofrecer un entorno de transferencia de archivos seguro a trav칠s de <strong>SFTP (SSH File Transfer Protocol)</strong>. SFTP es un protocolo que funciona sobre SSH y permite subir, descargar y gestionar archivos en el servidor remoto de forma segura.</p>
<p>Para habilitar SFTP, el servidor <code>sshd</code> debe tener configurada la directiva <code>Subsystem</code> en su fichero <code>sshd_config</code> de la siguiente manera:</p>
<pre data-role="codeBlock" data-info="text" class="language-text text"><code>Subsystem sftp internal-sftp
</code></pre><p>SFTP funciona de forma an치loga a FTP, pero con la ventaja de que todo el tr치fico est치 cifrado gracias a SSH. Los usuarios pueden conectarse a trav칠s de un cliente SFTP (como <code>sftp</code> o clientes gr치ficos como FileZilla) y realizar operaciones de gesti칩n de archivos (listar directorios, subir, descargar, borrar, etc.) en el servidor remoto. El repertorio de comandos disponibles en SFTP es pr치cticamente el mismo que el de un cliente FTP tradicional.</p>
<div class="admonition example">
<p class="admonition-title">Configuraci칩n de SFTP</p>
<p>El siguiente ejemplo habilita el servicio SFTP en el servidor SSH y fuerza a los usuarios del grupo <code>sftpusers</code> a usar SFTP sin acceso a la consola, encerrados en una jaula <code>chroot</code> en el directorio <code>/sftp/&lt;usuario&gt;</code>.</p>
<pre data-role="codeBlock" data-info="text" class="language-text text"><code>Subsystem sftp internal-sftp

Match Group sftpusers
    ChrootDirectory /sftp/%u
    ForceCommand internal-sftp
    X11Forwarding no
    AllowTcpForwarding no
</code></pre><p>En este caso, cualquier usuario que pertenezca al grupo <code>sftpusers</code> se ver치 restringido a un entorno SFTP sin acceso a la consola y quedar치 encerrado en una jaula <code>chroot</code> ubicada en <code>/sftp/&lt;usuario&gt;</code>. Adem치s, se desactivan el reenv칤o de X11 y la creaci칩n de t칰neles para estos usuarios, aumentando as칤 la seguridad del entorno SFTP. La variable <code>%u</code> en <code>ChrootDirectory</code> se reemplaza autom치ticamente por el nombre del usuario que se est치 autenticando.</p>
</div>
<h3 id="prueba-de-la-configuraci칩n">PRUEBA DE LA CONFIGURACI칍N </h3>
<p>Una vez realizada la configuraci칩n, es importante probar que el servidor SSH funciona correctamente y que las restricciones y pol칤ticas de acceso se aplican como se espera. Para ello, se pueden realizar pruebas de conexi칩n desde un cliente SSH utilizando diferentes usuarios, ubicaciones y m칠todos de autenticaci칩n.</p>
<h4 id="validaciones-del-fichero-de-configuraci칩n">VALIDACIONES DEL FICHERO DE CONFIGURACI칍N </h4>
<p>Antes de realizar pruebas de conexi칩n debemos comprobar la sintaxis de la configuraci칩n con el comando <strong><code>sshd -t</code></strong>.<br>
A continuaci칩n podemos utilizar el comando <strong><code>sshd -T</code></strong>. Este comando muestra la configuraci칩n que se aplicar치 a las conexiones entrantes, teniendo en cuenta tanto las directivas globales como las reglas espec칤ficas definidas en bloques <code>Match</code>. Es una herramienta muy 칰til para revisar y depurar la configuraci칩n del servidor SSH antes de realizar pruebas de conexi칩n. No solo muestra las directivas configuradas explicitamente en el fichero <code>sshd_config</code>, sino que tambi칠n muestra los valores por defecto de las directivas que no se han configurado expl칤citamente.</p>
<div class="admonition example">
<p class="admonition-title">Prueba de la configuraci칩n</p>
<p>Vamos a verificar una serie de aspectos de la configuraci칩n del servidor SSH utilizando el comando <code>sshd -T</code>.<br>
Supongamos que no hemos configurado ninguna directiva de autenticaci칩n explictamente.  Qu칠 m칠todos de autenticaci칩n estar치n permitidos por defecto ?</p>
<pre data-role="codeBlock" data-info="text" class="language-text text"><code>root@SSHSERVER:~# sshd -T | grep -i Authentication
hostbasedauthentication no
pubkeyauthentication yes
kerberosauthentication no
gssapiauthentication no
passwordauthentication yes
kbdinteractiveauthentication no
challengeresponseauthentication no
authenticationmethods any
root@SSHSERVER:~#
</code></pre><p>Podemos ver que, por defecto, el servidor SSH permite la autenticaci칩n mediante contrase침a (<code>passwordauthentication yes</code>) y mediante claves p칰blicas (<code>pubkeyauthentication yes</code>).<br>
Supongamos que hemos configurado explicitamente la directiva PasswordAuthentication con valor <em>no</em> y posteriormente, m치s abajo en el archivo, por error la hemos vuelto a configurar con valor <em>yes</em>.  Estar칤a permitida la autenticaci칩n por contrase침a ?</p>
<pre data-role="codeBlock" data-info="text" class="language-text text"><code>root@SSHSERVER:~# sshd -T | grep -i passwordauth
passwordauthentication no
root@SSHSERVER:~#
</code></pre><p>Vemos que el resultado es no, ya que la primera definici칩n de <code>PasswordAuthentication</code> es la que se aplica, y las definiciones posteriores no tienen ning칰n efecto.</p>
</div>
<div class="admonition example">
<p class="admonition-title">Prueba de la configuraci칩n con bloques Match</p>
<p>Vamos a a침adir un bloque <code>Match</code> para el usuario <code>u1</code> de manera que no pueda autenticarse de ninguna manera si accede desde la red 192.168.1.0/24. Tendremos explicitamente configurada de manera global la directiva <code>PasswordAuthentication yes</code>. A continuaci칩n se presenta un extracto de la configuraci칩n:</p>
<pre data-role="codeBlock" data-info="text" class="language-text text"><code>...
PasswordAuthentication yes
...
Match User u1 Address 192.168.1.0/24
    PasswordAuthentication no
    PubkeyAuthentication no
</code></pre><p> Podr칤a el usuario <code>u1</code> autenticarse de alguna manera si accede desde la red 192.168.1.0/24 ?<br>
Ejecutamos el comando <code>sshd -T</code> indicando el usuario y la direcci칩n de origen para simular la conexi칩n de <code>u1</code> desde esa red:</p>
<pre data-role="codeBlock" data-info="text" class="language-text text"><code>root@SSHSERVER:~# sshd -T -C user=u1,addr=192.168.1.10 | grep -i authentication
hostbasedauthentication no
pubkeyauthentication no
kerberosauthentication no
gssapiauthentication no
passwordauthentication no
kbdinteractiveauthentication no
challengeresponseauthentication no
authenticationmethods any
root@SSHSERVER:~#
</code></pre><p>Podemos ver que las reglas del bloque <code>Match</code> han sobrescrito las directivas globales, y por lo tanto el usuario <code>u1</code> no podr칤a autenticarse de ninguna manera si accede desde la red <code>192.168.1.0/24</code>.<br>
Supongamos que ponemos otro bloque Match encima de este de manera que permita al usuario <code>u1</code> autenticarse mediante clave p칰blica. La nueva configuraci칩n es la siguiente:</p>
<pre data-role="codeBlock" data-info="text" class="language-text text"><code>...
PasswordAuthentication yes
...
Match User u1
    PubkeyAuthentication yes
Match User u1 Address 192.168.1.0/24
    PasswordAuthentication no
    PubkeyAuthentication no
</code></pre><p> Podr칤a el usuario <code>u1</code> autenticarse mediante clave p칰blica si accede desde la red <code>192.168.1.0/24</code> ?  Y mediante contrase침a ?</p>
<pre data-role="codeBlock" data-info="text" class="language-text text"><code>root@SSHSERVER:~# sshd -T -C user=u1,addr=192.168.1.10 | grep -i authentication
hostbasedauthentication no
pubkeyauthentication yes
kerberosauthentication no
gssapiauthentication no
passwordauthentication no
kbdinteractiveauthentication no
challengeresponseauthentication no
authenticationmethods any
root@SSHSERVER:~#
</code></pre><p>Vemos que el usuario <code>u1</code> verifica la condici칩n del primer bloque <code>Match</code> y fija la directiva <code>PubKeyAuthentication yes</code>. Aunque entre en el siguiente bloque Match, la directiva ya no se sobreescribe, se queda con el valor asignado en el primer bloque <code>Match</code>. Podemos ver como la directiva <code>PasswordAuthentication no</code>, puesto que sobreescribe el valor global.</p>
</div>
<h4 id="validaciones-de-restricciones-temporales">VALIDACIONES DE RESTRICCIONES TEMPORALES </h4>
<p>Es posible probar las restricciones temporales configuradas con PAM mediante la utilidad <strong>faketime</strong>, que permite simular la fecha y hora del sistema para ejecutar comandos como si se estuvieran ejecutando en un momento concreto. Para profundizar m치s en el uso de <code>faketime</code>, se puede consultar la documentaci칩n anexa o la documentaci칩n oficial y las p치ginas del manual (<code>man faketime</code>).</p>
<p>En los sistemas Debian y derivados modernos, cuando utilizamos <code>faketime</code> para pasarle a <code>sshd</code> la fecha cambiada, se produce un error que literalmente dice: <em>"Missing privilege separation directory: /run/sshd"</em>. Esto se debe a que el servicio SSH utiliza la funcionalidad de <em>privilege separation</em> para mejorar la seguridad, y esta funcionalidad requiere que exista un directorio espec칤fico (<code>/run/sshd</code>) con permisos adecuados. Cuando se ejecuta <code>faketime</code> para simular una conexi칩n, el servicio SSH intenta acceder a este directorio y, si no lo encuentra o no tiene los permisos correctos, se produce el error mencionado. Para solucionar este problema, es necesario crear el directorio <code>/run/sshd</code> y asegurarse de que tiene los permisos adecuados (normalmente, propietario <code>root</code> y permisos <code>755</code>). El problema es que cada vez que se para el servicio SSH, el directorio <code>/run/sshd</code> se borra. Se puede solucionar el problema haciendo que ese directorio no se borre al parar el servicio editando el fichero <code>/etc/tmpfiles.d/sshd.conf</code> y a침adiendo la siguiente l칤nea:</p>
<pre data-role="codeBlock" data-info="text" class="language-text text"><code>d /run/sshd 0755 root root -
</code></pre><p>Esta l칤nea crea una entrada de tipo <code>d</code> (directorio) con la ruta <code>/run/sshd</code>, con permisos <code>0755</code>, propietario <code>root</code> y grupo <code>root</code>. El gui칩n indica que no se apliquen restricciones adicionales. Con esta configuraci칩n, <code>systemd</code> se encargar치 de mantener el directorio <code>/run/sshd</code> incluso despu칠s de parar el servicio SSH, y lo crear치 autom치ticamente si no existe cuando se inicie el servicio SSH, evitando as칤 el error al usar <code>faketime</code> para probar las restricciones temporales.</p>
<p>Despu칠s de realizar esta configuraci칩n, podemos forzar la creaci칩n inmediata del directorio con el comando:</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>systemd-tmpfiles <span class="token parameter variable">--create</span>
</code></pre><div class="admonition example">
<p class="admonition-title">Prueba de restricciones temporales</p>
<p>Supongamos que hemos configurado una restricci칩n temporal para el servicio SSH que solo permite el acceso de lunes a viernes de 8:00 a 14:00 horas. La configuraci칩n en <code>/etc/security/time.conf</code> ser칤a la siguiente:</p>
<pre data-role="codeBlock" data-info="text" class="language-text text"><code>sshd;*;*;Wk0800-1400
</code></pre><p>Previamente, hemos activado la integraci칩n con PAM en <code>sshd_config</code>.</p>
<pre data-role="codeBlock" data-info="text" class="language-text text"><code>root@SSHSERVER:~# sshd -T | grep -i PAM
usepam yes
root@SSHSERVER:~#
</code></pre><p>A continuaci칩n, hemos configurado PAM para que utilice el m칩dulo <strong>pam_time</strong> (viene preinstalado en la mayor칤a de distribuciones).</p>
<pre data-role="codeBlock" data-info="text" class="language-text text"><code># Archivo /etc/pam.d/sshd
...
account required pam_time.so
...
</code></pre><p>Para probar esta restricci칩n, podemos utilizar <code>faketime</code> para simular una conexi칩n en momentos permitidos y no permitidos por la restricci칩n temporal.<br>
El primer paso es parar el servicio SSH:</p>
<pre data-role="codeBlock" data-info="text" class="language-text text"><code>root@SSHSERVER:~# systemctl stop sshd
</code></pre><p>A continuaci칩n, simulamos una conexi칩n el lunes 16 de febrero de 2026 a las 10:00 horas. Para ello, ejecutamos el proceso <code>sshd</code> con <code>faketime</code> para que piense que es esa fecha y hora:</p>
<pre data-role="codeBlock" data-info="text" class="language-text text"><code>root@SSHSERVER:~# faketime -m '2026-02-16 10:00' /usr/bin/sshd -D
_
</code></pre><p>A continuaci칩n, desde otro terminal, intentamos conectarnos al servidor SSH con el usuario <code>u1</code>:</p>
<pre data-role="codeBlock" data-info="text" class="language-text text"><code>Alpine:~# ssh u1@192.168.1.5
...
u1@192.168.1.5's password:
Linux SSHSERVER 5.10.0-38-amd64 #1 SMP Debian 5.10.249-1 (2026-02-10) x86_64
...
Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
Last login: Mon Feb 23 12:00:18 2026 from 192.168.2.199
u1@SSHSERVER:~$
</code></pre><p>Podemos ver que hemos podido conectarnos ya que la conexi칩n se ha realizado dentro del horario permitido.<br>
Ahora finalizamos el proceso <code>sshd</code> que se est치 ejecutando con <code>faketime</code> y simulamos una conexi칩n el mismo d칤a pero a las 19:00 horas:</p>
<pre data-role="codeBlock" data-info="text" class="language-text text"><code>root@SSHSERVER:~# faketime -m '2026-02-16 19:00' /usr/sbin/sshd -D -e
Server listening on 0.0.0.0 port 22.
Server listening on :: port 22.
_
</code></pre><p>Con la opci칩n <code>-e</code> hacemos que los mensajes de error se muestren por la salida est치ndar, lo que nos permitir치 ver el motivo por el que se deniega la conexi칩n.<br>
Desde otro terminal, intentamos conectarnos al servidor SSH:</p>
<pre data-role="codeBlock" data-info="text" class="language-text text"><code> Alpine:~# ssh u1@192.168.1.5
 ...
 u1@192.168.1.5's password:
 Connection closed by 192.168.1.5 port 22
 Alpine:~#
</code></pre><p>En la consola donde se est치 ejecutando <code>faketime</code>, vemos el siguiente mensaje de error:</p>
<pre data-role="codeBlock" data-info="text" class="language-text text"><code>root@SSHSERVER:~# faketime -m '2026-02-16 19:00' /usr/sbin/sshd -D -e
Server listening on 0.0.0.0 port 22.
Server listening on :: port 22.
Failed password for u1 from 192.168.2.199 port 50592 ssh2
Access denied for user u1 by PAM account configuration [preauth]
_
</code></pre><p>Es logico que se deniegue la conexi칩n, ya que nos hemos conectado fuera del horario permitido por la restricci칩n temporal configurada en <code>/etc/security/time.conf</code>.</p>
</div>
<h3 id="logging-y-auditor칤a">LOGGING Y AUDITOR칈A </h3>
<p>El servidor SSH registra en los ficheros de log del sistema (normalmente en <code>/var/log/auth.log</code> o <code>/var/log/secure</code>, dependiendo de la distribuci칩n) informaci칩n sobre las conexiones entrantes, intentos de autenticaci칩n, errores, etc. Es importante revisar estos logs peri칩dicamente para detectar posibles intentos de intrusi칩n o problemas de configuraci칩n. Adem치s, se pueden configurar opciones adicionales de logging en <code>sshd_config</code> para aumentar el nivel de detalle o enviar los logs a un servidor remoto.</p>
<p>Las directivas relacionadas con el logging en <code>sshd_config</code> incluyen:</p>
<ul>
<li><code>LogLevel</code>  nivel de detalle de los logs (por ejemplo, <code>INFO</code>, <code>VERBOSE</code>, <code>DEBUG</code>).</li>
<li><code>SyslogFacility</code>  categor칤a de syslog para los mensajes de SSH (por ejemplo, <code>AUTH</code>, <code>AUTHPRIV</code>, etc.).</li>
<li><code>LogFacility</code>  destino de los logs (por ejemplo, <code>FILE:/var/log/ssh.log</code> para enviar los logs a un fichero espec칤fico).</li>
<li><code>LogVerbose</code>  si se establece en <code>yes</code>, se incluir치 informaci칩n adicional en los logs, como la direcci칩n IP del cliente, el nombre de usuario, etc.</li>
</ul>
<p>Adem치s de los logs del sistema, OpenSSH tambi칠n puede generar logs espec칤ficos de auditor칤a si se configura adecuadamente. Esto permite registrar eventos relacionados con la autenticaci칩n, comandos ejecutados, transferencias de archivos, etc., lo que resulta 칰til para cumplir con requisitos de seguridad o normativas de auditor칤a.<br>
Los logs de auditor칤a se pueden configurar mediante la directiva <code>AuditLog</code> en <code>sshd_config</code>, indicando la ruta del fichero donde se almacenar치n los eventos de auditor칤a. Por ejemplo:</p>
<pre data-role="codeBlock" data-info="text" class="language-text text"><code>AuditLog /var/log/ssh_audit.log
</code></pre><p>Con esta configuraci칩n, se generar치 un fichero de log espec칤fico para auditor칤a de SSH en <code>/var/log/ssh_audit.log</code>, donde se registrar치n eventos detallados relacionados con las conexiones, autenticaciones y actividades realizadas a trav칠s de SSH.</p>
<p><strong>Utilizaci칩n de journald para logs de SSH</strong><br>
En sistemas que utilizan <code>systemd</code>, como Debian, los logs de SSH se pueden gestionar a trav칠s de <code>journald</code>, el sistema de logging integrado en <code>systemd</code>. En este caso, los mensajes relacionados con SSH se pueden consultar utilizando el comando <code>journalctl</code> con el filtro adecuado. Por ejemplo:</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>journalctl <span class="token parameter variable">-u</span> sshd
</code></pre><p>Este comando mostrar치 los logs relacionados con el servicio <code>sshd</code>, permitiendo revisar las conexiones, intentos de autenticaci칩n y otros eventos relevantes. Adem치s, <code>journald</code> ofrece opciones avanzadas de filtrado, b칰squeda y rotaci칩n de logs, lo que facilita la gesti칩n de los registros de SSH en sistemas modernos basados en <code>systemd</code>.</p>
<h3></h3>
<h2 id="cliente-ssh">CLIENTE SSH </h2>
<h3 id="instalaci칩n-1">INSTALACI칍N </h3>
<p>El cliente OpenSSH suele venir instalado por defecto en muchas distribuciones GNU/Linux. Si no estuviera disponible, se puede instalar el paquete <code>openssh-client</code> (o similar) usando el gestor de paquetes correspondiente. En sistemas basados en Debian podr칤a hacerse, por ejemplo, con:</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code><span class="token function">sudo</span> <span class="token function">apt</span> update
<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> openssh-client
</code></pre><h3 id="programas-disponibles">PROGRAMAS DISPONIBLES </h3>
<p>Una vez instalado el cliente OpenSSH, el sistema dispone de un conjunto de herramientas orientadas al uso desde la m치quina cliente. Muchas de ellas ya se han mencionado al describir el servidor, pero desde el punto de vista del usuario que se conecta conviene destacar las siguientes:</p>
<ul>
<li><code>ssh</code>: programa principal para establecer conexiones remotas interactivas o ejecutar comandos en otros equipos.</li>
<li><code>scp</code>: utilidad para copiar archivos y directorios de forma segura entre el cliente y el servidor.</li>
<li><code>sftp</code>: cliente interactivo de transferencia de archivos sobre SSH, pensado para subir, descargar y gestionar ficheros remotos.</li>
<li><code>ssh-copy-id</code>: herramienta que copia la clave p칰blica del usuario al servidor, facilitando la configuraci칩n de la autenticaci칩n sin contrase침a.</li>
<li>Herramientas de apoyo a la gesti칩n de claves: <code>ssh-add</code>, <code>ssh-keyscan</code>, <code>ssh-keygen</code>, <code>ssh-agent</code>.</li>
</ul>
<h3 id="archivos-de-configuraci칩n-del-cliente">ARCHIVOS DE CONFIGURACI칍N DEL CLIENTE </h3>
<p>El comportamiento del cliente SSH tambi칠n se controla mediante distintos ficheros de configuraci칩n y claves que se encuentran repartidos entre la configuraci칩n global del sistema y el directorio personal de cada usuario. Los m치s habituales son:</p>
<ul>
<li><code>/etc/ssh/ssh_config</code><br>
Fichero de configuraci칩n global del cliente SSH para todo el sistema, aplicable a todos los usuarios salvo que se sobreescriba con ajustes personales.</li>
<li><code>/home/&lt;usuario&gt;/.ssh/known_hosts</code><br>
Lista de servidores que el usuario ya ha autenticado y que se consideran seguros (almacena las claves p칰blicas de host).</li>
<li><code>/home/&lt;usuario&gt;/.ssh/config</code><br>
Archivo de configuraci칩n espec칤fico del cliente SSH para un usuario concreto, en el que se pueden definir alias de hosts, puertos alternativos, usuarios por defecto, etc.</li>
<li><code>/home/&lt;usuario&gt;/.ssh/id_[tipo_clave]</code><br>
Clave privada del usuario. La palabra <em>tipo_clave</em> puede ser <code>rsa</code>, <code>ecdsa</code>, <code>ed25519</code>, etc.</li>
<li><code>/home/&lt;usuario&gt;/.ssh/id_[tipo_clave].pub</code><br>
Clave p칰blica del usuario asociada a la clave privada anterior. Es la que se copia al servidor para la autenticaci칩n basada en claves.</li>
</ul>
<h3 id="conexi칩n-y-desconexi칩n">CONEXI칍N Y DESCONEXI칍N </h3>
<p>El uso m치s habitual del cliente SSH consiste en abrir una sesi칩n remota en otro equipo. Para ello, se ejecuta el comando <code>ssh</code> indicando el usuario y la m치quina a la que se desea conectar. Si no se indica expl칤citamente el usuario remoto, se utilizar치 por defecto el mismo nombre de usuario con el que estamos conectados en el sistema local.</p>
<p>Una vez establecida la conexi칩n, trabajaremos en la consola del equipo remoto como si estuvi칠ramos sentados delante de 칠l. Cuando terminemos, la sesi칩n se cierra utilizando comandos como <code>exit</code> o <code>logout</code>, o bien cerrando directamente la terminal.</p>
<div class="admonition example">
<p class="admonition-title">Conexi칩n SSH</p>
<p>En el siguiente ejemplo nos conectaremos, desde un cliente Alpine Linux, al servidor ssh (Debian) con el usuario <code>sshuser1</code>. La ip del servidor es la 192.168.1.5.<br>
En las distribuciones Alpine Linux, el cliente SSH no viene instalado por defecto, por lo que el primer paso es instalarlo.</p>
<pre data-role="codeBlock" data-info="text" class="language-text text"><code>Alpine:~# apk add openssh-client
(1/4) Installing openssh-keygen (10.2_p1-r0)
(2/4) Installing libedit (20251016.3.1-r0)
(3/4) Installing openssh-client-common (10.2_p1-r0)
(4/4) Installing openssh-client-default (10.2_p1-r0)
Executing busybox-1.37.0-r30.trigger
OK: 176.4 MiB in 99 packages
Alpine:~#
</code></pre><p>A continuaci칩n, se establece la conexi칩n con el servidor SSH con el usuario <code>sshuser1</code>. Se supone que el servidor est치 configurado para aceptar conexiones SSH y que existe el usuario <code>sshuser1</code>.</p>
<pre data-role="codeBlock" data-info="text" class="language-text text"><code>Alpine:~# ssh sshuser1@192.168.1.5
The authenticity of host '192.168.1.5 (192.168.1.5)' can't be established.
ED25519 key fingerprint is SHA256:GV0L9lTQT+DNDPqXQTZgITPBEIu+u0ix7wh9RC42j칑jQ
This key is not known by any other names.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '192.168.1.5' (ED25519) to the list of known hosts.
...
...
sshuser1@192.168.1.5's password:
Linux SSHSERVER 5.10.0-38-amd64 #1 SMP Debian 5.10.249-1 (2026-02-10) x86_64
...
...
sshuser1@SSHSERVER:~$
</code></pre><p>En este intercambio de mensajes puede verse que es la primera vez que el cliente se conecta al servidor <code>192.168.1.5</code>. El servidor pide al cliente que acepte su clave p칰blica y esta se a침ade al fichero ~/.ssh/known_hosts del cliente.<br>
Fij칠mosnos que una vez conectados ha cambiado el prompt de la terminal.</p>
</div>
<p>El cliente SSH guarda en el fichero ~/.ssh/known_hosts las claves p칰blicas de los servidores a los que se conecta. Para un mismo servidor puede haber varias l칤neas: una por cada tipo de clave de host que el servidor tenga configurado (por ejemplo, ED25519, ECDSA o RSA). En la primera conexi칩n, como el cliente todav칤a no conoce ninguna clave, muestra un aviso indicando que la autenticidad del host no puede establecerse y ense침a la huella (fingerprint) de una de esas claves. Si aceptamos (yes), esa clave se a침ade a known_hosts. En las versiones actuales de OpenSSH, una vez aceptada la primera clave, el servidor puede enviar por el canal cifrado el resto de claves de host que tiene, y el cliente tambi칠n las guarda autom치ticamente; por eso, aun habi칠ndonos conectado solo una vez, es normal ver varias claves para la misma IP o nombre en known_hosts.</p>
<p>Si queremos ver las claves de host de un servidor antes de conectarnos (o sin abrir una sesi칩n interactiva), podemos usar el comando ssh-keyscan. Este comando pregunta al servidor qu칠 claves de host tiene y las muestra todas, una por l칤nea, sin modificar por s칤 mismo nuestro known_hosts. Es habitual que ssh-keyscan servidor muestre m치s claves de las que vemos en ~/.ssh/known_hosts: ssh-keyscan ense침a todas las claves que el servidor anuncia, mientras que known_hosts solo contiene las que nuestro cliente ha ido aprendiendo y aceptando a lo largo de sus conexiones.</p>
<div class="admonition example">
<p class="admonition-title">Clave p칰blica del servidor</p>
<p>En este ejemplo comprobaremos que la clave p칰blica del servidor que tengo en <code>~/.ssh/known_hosts</code> es la misma que se muestra al ejecutar <code>ssh-keyscan</code> para el servidor <code>192.168.1.5</code>.</p>
<pre data-role="codeBlock" data-info="text" class="language-text text"><code>Alpine:~# cat ~/.ssh/known_hosts
192.168.1.5 ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIPSp0Ned52etjvIkefzCnk6p4AhWlu0uZzY4fmBCb0RC
192.168.1.5 ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmIzdhA6YNTYAAAAlbmIzdhA6YNTYAAABBB0EPAK85iPeMQSfsz22dGAW4532Bfcr1fjHdWgnYh3oRPKoPs5COi+fsFeDStNnWk7D+MxuQ1x9uSB6Zarwxs+s=
Alpine:~#
</code></pre><p>A continuaci칩n prguntamos al servidor por su clave p칰blica con el comando <code>ssh-keyscan</code>:</p>
<pre data-role="codeBlock" data-info="text" class="language-text text"><code>Alpine:~# ssh-keyscan 192.168.1.5
# 192.168.1.5:22 SSH-2.0-OpenSSH_8.4p1 Debian-5+deb11u5
# 192.168.1.5:22 SSH-2.0-OpenSSH_8.4p1 Debian-5+deb11u5
192.168.1.5 ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDKDQcqvXhV+4JQ5UPGTi24y8jVGnM9cI1acBCC8s/L0bIrp7pvMAQm5EwXpjp3WXh0QOs/UadKrSKBcy46+p7to/ix7YZ4vowzMW8FC3Zjr7Ae0OZnfkkD4O++KjgxLzjtrmeuvpujkcKLfZ65oaEbLkrnBARWOOk/ZLmfJ0F84qIpE7jXk1zb6uC+lHlT2TeRd6Cx6qlxVp8JicPxwJ/WWTyLkbRavrvDm18HcOw1daW4KCnMAh5KbN0pe/m/ekRteObzRsIUlS04NsnAps82EcABtTLrr+Od3Rh50dtY6zp2eiN22Lcze4p/9DxG59eH7B2RznymeGYIMUqf9ZvkixdKyyyVWQGJ54nB1LuDiWJ5BynsU93c0xdZQ9FrfTmdHkny0BOT8RyKFIgjO2xgv2qjZ0YvXDRGz/NIEgXWQnBNAatCAZRhPlwKarPGQNIKW+Nb246c9JdC/Z/3ezIBYoxXjY85Krax4ljuryd9DQVKvE6ywrNfHZqLHr38r7M=
# 192.168.1.5:22 SSH-2.0-OpenSSH_8.4p1 Debian-5+deb11u5
192.168.1.5 ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmIzdhAwNTYAAAAlbmIzdhAwNTYAAABBBDEPAK85iPeMQSfsz22dGAW4532Bfcr1fjHdWgnYh3oRPKoPs5COi+fsFeDStNnWk7D+MxuQ1x9uSB6Zarwxs+s=
# 192.168.1.5:22 SSH-2.0-OpenSSH_8.4p1 Debian-5+deb11u5
192.168.1.5 ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIPSp0Ned52etjvIkefzCnk6p4AhWlu0uZzY4fmBCb0RC
# 192.168.1.5:22 SSH-2.0-OpenSSH_8.4p1 Debian-5+deb11u5
Alpine:~#
</code></pre><p>Podemos ver que las dos claves p칰blicas que se muestran al ejecutar <code>ssh-keyscan</code> coinciden con las que tenemos en el fichero <code>~/.ssh/known_hosts</code>, lo que confirma que el servidor es el mismo al que nos hemos conectado anteriormente y que no ha habido ning칰n cambio en sus claves de host.</p>
</div>
<p>Para cerrar una sesi칩n SSH, se puede usar el comando <code>exit</code> o <code>logout</code>, o simplemente cerrar la terminal.</p>
<div class="admonition example">
<p class="admonition-title">Conexi칩n SSH</p>
<p>Tras cerrar la sesi칩n, nos volveremos a encontrar en la terminal del cliente, con el prompt habitual.</p>
<pre data-role="codeBlock" data-info="text" class="language-text text"><code>sshuser1@SSHSERVER:~$ exit
logout
Connection to 192.168.1.5 closed.
Alpine:~# ssh sshuser1@192.168.1.5
...
...
sshuser1@192.168.1.5's password:
Linux LSSHSERVER 5.10.0-38-amd64 #1 SMP Debian 5.10.249-1 (2026-02-10) x86_64
...
...
sshuser1@LSSHSERVER:~$
</code></pre></div>
<p>Ahora, al volver a conectarnos al servidor, el cliente SSH ya reconoce la clave p칰blica del servidor (porque la guard칩 en <code>~/.ssh/known_hosts</code> en la conexi칩n anterior) y no muestra el aviso de autenticidad del host. Sin embargo, como no hemos configurado a칰n la autenticaci칩n sin contrase침a, el servidor nos pide la contrase침a del usuario <code>sshuser1</code> para completar la conexi칩n.</p>
<h3 id="generaci칩n-de-claves-p칰blicas-y-privadas">GENERACI칍N DE CLAVES P칔BLICAS Y PRIVADAS </h3>
<p>Si queremos evitar el uso de contrase침as en cada conexi칩n y aprovechar la autenticaci칩n basada en claves, en la m치quina cliente se siguen tres pasos principales:</p>
<ul>
<li>generar un par de claves</li>
<li>copiar la clave p칰blica al servidor</li>
<li>conectarse utilizando la clave privada</li>
</ul>
<p><strong>Generar un par de claves (p칰blica y privada) con el comando <code>ssh-keygen</code></strong><br>
El comando <code>ssh-keygen</code> se utiliza para crear un par de claves criptogr치ficas (p칰blica y privada) que permiten la autenticaci칩n sin contrase침a en SSH. Su sintaxis b치sica es la siguiente:</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>ssh-keygen <span class="token punctuation">[</span>opciones<span class="token punctuation">]</span>
</code></pre><p>donde las opciones permiten configurar el tipo de clave, su tama침o, la frase secreta que la protege, el nombre del archivo donde se guardar치 la clave privada, etc. En las versiones actuales de OpenSSH, si se ejecuta sin opciones se generar치 por defecto una clave de tipo <code>ed25519</code> y se guardar치 en el directorio <code>~/.ssh/</code> con el nombre <code>id_ed25519</code> para la clave privada y <code>id_ed25519.pub</code> para la clave p칰blica. Antiguamente se generaba por defecto una clave RSA de 2048 bits, pero en las versiones m치s recientes se ha cambiado a <code>ed25519</code> por ser un algoritmo m치s moderno y seguro.</p>
<p>La siguiente tabla resume las opciones m치s comunes que se pueden usar con <code>ssh-keygen</code> para personalizar la generaci칩n de claves:</p>
<table>
<thead>
<tr>
<th>Par치metro</th>
<th>Descripci칩n</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-t</code></td>
<td>Define el tipo de clave a generar (por ejemplo, <code>rsa</code>, <code>ecdsa</code>, <code>ed25519</code>).</td>
</tr>
<tr>
<td><code>-b</code></td>
<td>Indica el tama침o de la clave en bits (por ejemplo, 2048 para RSA).</td>
</tr>
<tr>
<td><code>-f</code></td>
<td>Especifica el nombre del archivo donde se guardar치 la clave privada (la clave p칰blica se guardar치 con el mismo nombre pero con la extensi칩n <code>.pub</code>).</td>
</tr>
<tr>
<td><code>-N</code></td>
<td>Permite establecer una frase secreta para proteger la clave privada. Si se indica <code>-N ""</code>, la clave privada no tendr치 frase secreta y podr치 usarse sin necesidad de introducir una contrase침a. Sin embargo, esta pr치ctica no es recomendable en entornos de producci칩n o con informaci칩n sensible, ya que si alguien obtiene acceso a la clave privada podr칤a usarla sin restricciones. En general, es aconsejable proteger la clave privada con una frase secreta y utilizar un agente de claves (<code>ssh-agent</code>) para gestionar su uso de forma segura.</td>
</tr>
<tr>
<td><code>-q</code></td>
<td>Activa el modo silencioso, evitando la salida de mensajes informativos durante la generaci칩n de claves.</td>
</tr>
<tr>
<td><code>-Z</code></td>
<td>Especifica el formato de la clave privada (por ejemplo, <code>PEM</code> o <code>RFC4716</code>).</td>
</tr>
</tbody>
</table>
<div class="admonition example">
<p class="admonition-title">Generaci칩n par de claves p칰blica/privada</p>
<p>En el siguiente ejemplo se ejecuta <code>ssh-keygen</code> en Alpine Linux sin opciones adicionales. El programa genera por defecto un par de claves de tipo <code>ed25519</code>, pregunta por la ruta donde guardarlas y solicita una frase secreta para proteger la clave privada:</p>
<pre data-role="codeBlock" data-info="text" class="language-text text"><code>Alpine:~# ssh-keygen
Generating public/private ed25519 key pair.
Enter file in which to save the key (/root/.ssh/id_ed25519):
Enter passphrase for '/root/.ssh/id_ed25519' (empty for no passphrase):
Enter same passphrase again:
Your identification has been saved in /root/.ssh/id_ed25519
Your public key has been saved in /root/.ssh/id_ed25519.pub
The key fingerprint is:
SHA256:PsBVJBCjD38gsMrRAM+XVJQaWuzMpnfIkj0zudlbc root@Alpine
The key's randomart image is:
+--[ED25519 256]--+
| .o      o.      |
| o o     o o.    |
| o  .   . o o .  |
| .  o +  . ooo . |
|  .  o S + . .   |
|       + o  .    |
|      + oo= o.   |
|       +.ooo.E   |
|         ..oo    |
+----[SHA256]-----+
Alpine:~#
</code></pre><p>Como se puede ver no hace falta indicar ninguna opci칩n, ya que los valores por defecto son los que se desean en este caso.</p>
</div>
<p><strong>Copiar la clave p칰blica al servidor</strong><br>
Para que el servidor SSH pueda reconocer nuestra clave p칰blica y permitir la autenticaci칩n sin contrase침a, es necesario copiar esa clave al servidor y a침adirla al fichero <code>authorized_keys</code> del usuario remoto. Para ello partimos de la clave p칰blica generada en el paso anterior (por ejemplo, <code>~/.ssh/id_ed25519.pub</code>) y la transferimos al servidor. Existen dos formas habituales de hacerlo:</p>
<ul>
<li>mediante <code>ssh-copy-id</code>, que automatiza todo el proceso;</li>
<li>o de forma manual, copiando la clave con <code>scp</code> y actualizando despu칠s el fichero <code>authorized_keys</code> en el servidor.</li>
</ul>
<div class="admonition example">
<p class="admonition-title">Copia de claves al servidor (m칠todo autom치tico)</p>
<p>En este ejemplo usamos <code>ssh-copy-id</code> desde Alpine Linux para copiar la clave p칰blica <code>id_ed25519.pub</code> del usuario root al servidor <code>192.168.1.5</code>, de forma que el usuario remoto <code>sshuser1</code> pueda autenticarse mediante clave en lugar de contrase침a.</p>
<pre data-role="codeBlock" data-info="text" class="language-text text"><code>Alpine:~# ssh-copy-id sshuser1@192.168.1.5
/usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: "/root/.ssh/id_ed25519.pub"
/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed
expr: warning: '^ERROR: ' using ^^ as the first character
of a basic regular expression is not portable; it is ignored
/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys
*** WARNING: connection is not using a post-quantum key exchange algorithm.
*** This session may be vulnerable to "store now, decrypt later" attacks.
*** The server may need to be upgraded. See https://openssh.com/pq.html
sshuser1@192.168.1.5's password:

Number of key(s) added: 1

Now try logging into the machine, with: "ssh 'sshuser1@192.168.1.5'"
and check to make sure that only the key(s) you wanted were added.

Alpine:~#
</code></pre><p>El propio <code>ssh-copy-id</code> indica cu치ntas claves se han a침adido al servidor (<code>Number of key(s) added: 1</code>) y recuerda que, a partir de ese momento, deber칤amos poder entrar con <code>ssh sshuser1@192.168.1.5</code> sin que se nos pida la contrase침a, ya que la autenticaci칩n se har치 con la clave p칰blica instalada.</p>
</div>
<p>Si por alg칰n motivo <code>ssh-copy-id</code> no estuviera disponible, podemos recurrir a <code>scp</code> y realizar el proceso de manera manual.</p>
<div class="admonition example">
<p class="admonition-title">Copia de claves al servidor (m칠todo manual)</p>
<p>En este caso no usamos <code>ssh-copy-id</code>. Copiamos manualmente la clave p칰blica desde el cliente Alpine (usuario root) hasta el servidor <code>192.168.1.5</code> y la a침adimos al fichero <code>authorized_keys</code> del usuario <code>sshuser1</code>.<br>
<strong>Soluci칩n</strong><br>
Los siguientes pasos detallan el proceso:</p>
<ul>
<li>Copiar la clave p칰blica generada en el cliente (por ejemplo <code>id_ed25519.pub</code>) al <code>home</code> del usuario remoto <code>sshuser1</code>:<pre data-role="codeBlock" data-info="text" class="language-text text"><code>Alpine:~# scp ~/.ssh/id_ed25519.pub sshuser1@192.168.1.5:/home/sshuser1/id_ed25519.pub
</code></pre></li>
<li>Conectarse al servidor <code>192.168.1.5</code> con el usuario <code>sshuser1</code> usando contrase침a:<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>Alpine:~<span class="token comment"># ssh sshuser1@192.168.1.5</span>
</code></pre></li>
<li>Crear el directorio <code>.ssh</code> (si no existe) y a침adir la clave p칰blica al fichero <code>authorized_keys</code>:<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>sshuser1@192.168.1.5:~$ <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> ~/.ssh
sshuser1@192.168.1.5:~$ <span class="token function">cat</span> id_ed25519.pub <span class="token operator">&gt;&gt;</span> ~/.ssh/authorized_keys
</code></pre></li>
</ul>
<ul>
<li>Eliminar el fichero temporal con la clave p칰blica y cerrar la sesi칩n en el servidor:<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>sshuser1@192.168.1.5:~$ <span class="token function">rm</span> id_ed25519.pub
sshuser1@192.168.1.5:~$ <span class="token builtin class-name">exit</span>
</code></pre></li>
</ul>
</div>
<p><strong>Realizar la conexi칩n utilizando la clave privada</strong><br>
Una vez que el servidor conoce nuestra clave p칰blica (porque la hemos instalado con <code>ssh-copy-id</code> o de forma manual), podemos conectarnos usando la clave privada en lugar de una contrase침a. Si utilizamos la ruta y el nombre por defecto (<code>~/.ssh/id_ed25519</code>, <code>~/.ssh/id_rsa</code>, etc.), normalmente basta con ejecutar <code>ssh usuario@servidor</code> y el propio cliente SSH buscar치 la clave adecuada.</p>
<p>En caso de que queramos utilizar un fichero de clave distinto al habitual, podemos indicarlo de forma expl칤cita con la opci칩n <code>-i</code> del comando <code>ssh</code>.</p>
<div class="admonition example">
<p class="admonition-title">Conexi칩n con clave privada</p>
<p>Conectarse desde el cliente Alpine al servidor <code>192.168.1.5</code> con el usuario <code>sshuser1</code>, utilizando la clave privada <code>id_ed25519</code> que el cliente encuentra en <code>~/.ssh</code>.</p>
<pre data-role="codeBlock" data-info="text" class="language-text text"><code>Alpine:~# ssh sshuser1@192.168.1.5
*** WARNING: connection is not using a post-quantum key exchange algorithm.
*** This session may be vulnerable to "store now, decrypt later" attacks.
*** The server may need to be upgraded. See https://openssh.com/pq.html
Linux SSHSERVER 5.10.0-38-amd64 #1 SMP Debian 5.10.249-1 (2026-02-10) x86_64

The programs included with the Debian GNU/Linux system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
permitted by applicable law.
Last login: Wed Feb 18 00:10:30 2026 from 192.168.1.198
sshuser1@SSHSERVER:~$  
</code></pre><p>En este ejemplo la clave privada <strong>no tiene frase de paso (passphrase)</strong>, por eso el cliente puede usarla directamente y no nos pide ninguna contrase침a local.</p>
</div>
<h3 id="uso-del-agente-de-claves">USO DEL AGENTE DE CLAVES </h3>
<p>Hasta ahora hemos utilizado una clave privada <strong>sin frase de paso</strong>. En este caso el agente de claves aporta poca ventaja: el cliente <code>ssh</code> puede leer la clave directamente del disco y conectarse sin pedir nada m치s.</p>
<p>El agente de claves <code>ssh-agent</code> se vuelve realmente 칰til cuando <strong>protegemos la clave privada con una passphrase</strong>. Entonces la situaci칩n es:</p>
<ul>
<li>Sin agente: cada vez que hacemos <code>ssh</code>, <code>scp</code>, <code>git pull</code> sobre ese servidor, se nos pide la passphrase de la clave.</li>
<li>Con agente: introducimos la passphrase <strong>una sola vez</strong>, el agente guarda la clave descifrada en memoria y las siguientes conexiones ya no la piden.</li>
</ul>
<p>Un flujo did치ctico completo ser칤a el siguiente.</p>
<p><strong>1. A침adir una passphrase a una clave ya existente</strong><br>
Suponemos que ya tenemos creada la clave <code>~/.ssh/id_ed25519</code> sin passphrase. Podemos a침adirle una frase de paso a posteriori con <code>ssh-keygen -p</code>:</p>
<div class="admonition example">
<p class="admonition-title">A침adir passphrase a una clave existente</p>
<pre data-role="codeBlock" data-info="text" class="language-text text"><code>Alpine:# ssh-keygen -p -f ~/.ssh/id_ed25519
Key has comment 'root@Alpine'
Enter new passphrase (empty for no passphrase):
Enter same passphrase again:
Your identification has been saved with the new passphrase.
Alpine:#
</code></pre><p>En este ejemplo se ha a침adido una passphrase a la clave <code>id_ed25519</code> que antes no ten칤a. A partir de ahora, cada vez que el cliente SSH intente usar esa clave para autenticarse, nos pedir치 la passphrase para descifrarla.</p>
</div>
<p><strong>2. Ver el efecto: ahora cada conexi칩n pide la passphrase</strong><br>
Si intentamos conectarnos de nuevo <strong>sin agente</strong>, el cliente nos pide la passphrase local antes de abrir la sesi칩n SSH:</p>
<div class="admonition example">
<p class="admonition-title">Conexi칩n pidiendo la passphrase</p>
<pre data-role="codeBlock" data-info="text" class="language-text text"><code>Alpine:~# ssh sshuser1@192.168.1.5
*** WARNING: connection is not using a post-quantum key exchange algorithm.
*** This session may be vulnerable to "store now, decrypt later" attacks.
*** The server may need to be upgraded. See https://openssh.com/pq.html
Enter passphrase for key '/root/.ssh/id_ed25519':
Linux SSHSERVER 5.10.0-38-amd64 #1 SMP Debian 5.10.249-1 (2026-02-10) x86_64
...
...
sshuser1@SSHSERVER:~$
</code></pre><p>Ahora, antes de establecer la conexi칩n SSH, el cliente nos pide la passphrase de la clave privada <code>id_ed25519</code> para poder usarla en la autenticaci칩n.</p>
</div>
<p><strong>3. Utilizar el agente para no repetir la passphrase en cada conexi칩n</strong><br>
Para evitar tener que escribir la passphrase en cada comando, arrancamos un agente y le a침adimos la clave una sola vez. A partir de ese momento, el agente se encargar치 de gestionar la clave en memoria y las conexiones SSH podr치n usarla sin volver a pedir la passphrase. El agente de claves se puede iniciar con <code>ssh-agent</code> y luego se a침aden las claves con <code>ssh-add</code>.</p>
<div class="admonition example">
<p class="admonition-title">Uso b치sico de ssh-agent</p>
<p>En este ejemplo se muestra c칩mo iniciar el agente de claves <code>ssh-agent</code>, a침adir la clave privada <code>id_ed25519</code> al agente y luego conectarse al servidor sin necesidad de introducir la passphrase en cada conexi칩n.</p>
<ol>
<li>Iniciar el agente en la sesi칩n actual del cliente Alpine:</li>
</ol>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>Alpine:~<span class="token comment"># eval "$(ssh-agent -s)"</span>
Agent pid <span class="token number">2711</span>
</code></pre><p>El comando <code>eval "$(ssh-agent -s)"</code> arranca el agente de claves y configura las variables de entorno necesarias para que el cliente SSH pueda comunicarse con 칠l. La salida muestra el PID del proceso del agente.<br>
2. A침adir la clave privada <code>id_ed25519</code> al agente (ahora s칤 se pedir치 la passphrase <strong>una sola vez</strong>):</p>
<pre data-role="codeBlock" data-info="text" class="language-text text"><code>Alpine:~# ssh-add ~/.ssh/id_ed25519
Enter passphrase for /root/.ssh/id_ed25519:
Identity added: /root/.ssh/id_ed25519 (root@Alpine)
</code></pre><ol start="3">
<li>Conectarse al servidor <code>192.168.1.5</code> como <code>sshuser1</code> sin necesidad de indicar la clave privada ni volver a escribir la passphrase:</li>
</ol>
<pre data-role="codeBlock" data-info="text" class="language-text text"><code>Alpine:~# ssh sshuser1@192.168.1.5
*** WARNING: connection is not using a post-quantum key exchange algorithm.
*** This session may be vulnerable to "store now, decrypt later" attacks.
*** The server may need to be upgraded. See https://openssh.com/pq.html
Linux SSHSERVER 5.10.0-38-amd64 #1 SMP Debian 5.10.249-1 (2026-02-10) x86_64
...
...
sshuser1@SSHSERVER:~$
</code></pre><p>Ahora el cliente SSH se conecta al servidor utilizando la clave privada gestionada por el agente, sin pedir la passphrase en esta ni en las siguientes conexiones mientras el agente siga activo.</p>
</div>
<p>Mientras el agente siga activo, cualquier conexi칩n que use esa clave se podr치 realizar sin volver a introducir la frase de paso.</p>
<p>Adem치s, el agente ofrece algunas utilidades adicionales:</p>
<ul>
<li>
<p>Para ver las claves p칰blicas correspondientes a las claves cargadas en el agente se puede utilizar el comando <code>ssh-add -L</code>. Este comando muestra la lista de claves p칰blicas que el agente tiene disponibles, una por l칤nea, con su tipo, su huella y su comentario (normalmente el nombre del usuario y el host).</p>
<div class="admonition example">
<p class="admonition-title">Ver claves p칰blicas cargadas en el agente</p>
<p>En este ejemplo se muestra la salida del comando <code>ssh-add -L</code> despu칠s de haber a침adido la clave privada <code>id_ed25519</code> al agente. La salida muestra la clave p칰blica correspondiente a esa clave privada, con su tipo (ssh-ed25519), su huella (fingerprint) y su comentario (root@Alpine).</p>
<pre data-role="codeBlock" data-info="text" class="language-text text"><code>Alpine:~# ssh-add -L
ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIGKhSdAPH0EIIuydqa966YFaBCuRFoTo/mRWSD000Jgyt root@Alpine
Alpine:~#
</code></pre></div>
<p>Si queremos ver solo las claves privadas cargadas en el agente, se emplea el comando <code>ssh-add -l</code>. Este comando muestra una lista de las claves privadas que el agente tiene en memoria, indicando su tipo, su huella y su comentario. La diferencia con <code>ssh-add -L</code> es que este 칰ltimo muestra las claves p칰blicas, mientras que <code>ssh-add -l</code> muestra las claves privadas (aunque no revela su contenido, solo su huella).</p>
<div class="admonition example">
<p class="admonition-title">Ver claves privadas cargadas en el agente</p>
<p>En este ejemplo se muestra la salida del comando <code>ssh-add -l</code> despu칠s de haber a침adido la clave privada <code>id_ed25519</code> al agente. La salida indica que hay una clave privada de tipo ED25519 cargada, con su huella (SHA256:PsB/UBCjD3BgsMrARM+XV/3QalWuzMpnfIkjozudlbc) y su comentario (root@Alpine).<br>
La salida de <code>ssh-add -l</code> no muestra el contenido de la clave privada, solo su huella y su comentario, para evitar revelar informaci칩n sensible. Sin embargo, nos permite confirmar que la clave privada est치 cargada en el agente y lista para ser utilizada en las conexiones SSH.</p>
<pre data-role="codeBlock" data-info="text" class="language-text text"><code>Alpine:~# ssh-add -l
256 SHA256:PsB/UBCjD3BgsMrARM+XV/3QalWuzMpnfIkjozudlbc root@Alpine (ED25519)
Alpine:~#
</code></pre></div>
</li>
<li>
<p>Para detener el agente y borrar de memoria todas las claves cargadas se emplea el comando <code>ssh-agent -k</code>. Este comando env칤a una se침al al proceso del agente para que se cierre y borre las claves de memoria. Adem치s, muestra un mensaje indicando que el agente ha sido detenido y las variables de entorno relacionadas han sido desconfiguradas.</p>
<div class="admonition example">
<p class="admonition-title">Detener el agente de claves</p>
<p>En este ejemplo se muestra c칩mo detener el agente de claves <code>ssh-agent</code> con el comando <code>ssh-agent -k</code>. La salida indica que las variables de entorno <code>SSH_AUTH_SOCK</code> y <code>SSH_AGENT_PID</code> han sido desconfiguradas (unset) y que el proceso del agente con PID 2711 ha sido terminado (killed).<br>
Despu칠s de ejecutar este comando, el agente ya no estar치 activo y las claves que ten칤a cargadas dejar치n de estar disponibles para las conexiones SSH.</p>
<pre data-role="codeBlock" data-info="text" class="language-text text"><code>Alpine:~# ssh-agent -k
unset SSH_AUTH_SOCK;
unset SSH_AGENT_PID;
echo Agent pid 2711 killed;
Alpine:~#
</code></pre><p>Al intentar conectarnos de nuevo al servidor despu칠s de haber detenido el agente, el cliente SSH ya no podr치 usar la clave privada que ten칤amos cargada en el agente, por lo que volver치 a pedir la passphrase para poder usar esa clave.</p>
<pre data-role="codeBlock" data-info="text" class="language-text text"><code>Alpine:~# ssh sshuser1@192.168.1.5
*** WARNING: connection is not using a post-quantum key exchange algorithm.
*** This session may be vulnerable to "store now, decrypt later" attacks.
*** The server may need to be upgraded. See https://openssh.com/pq.html
Enter passphrase for key '/root/.ssh/id_ed25519':

</code></pre></div>
</li>
</ul>
<h3 id="copiar-ficheros-con-scp-y-sftp">COPIAR FICHEROS CON SCP y SFTP </h3>
<p>La transferencia de archivos entre el cliente y el servidor SSH se puede realizar de forma segura utilizando las herramientas <code>scp</code> y <code>sftp</code>, que funcionan sobre el protocolo SSH para cifrar los datos durante la transferencia.</p>
<p>El <strong>comando <code>scp</code> (secure copy)</strong> tiene una sintaxis similar a <code>cp</code>, pero permite copiar archivos entre el cliente y el servidor de forma remota.</p>
<div class="admonition example">
<p class="admonition-title">Copia de archivos con scp</p>
<p>Copiar un archivo llamado <code>documento.txt</code> desde el cliente Alpine al servidor <code>192.168.1.5</code> usando el usuario <code>sshuser1</code>.</p>
<pre data-role="codeBlock" data-info="text" class="language-text text"><code>Alpine:~# scp documento.txt sshuser1@192.168.1.5:/home/sshuser1/
</code></pre><p>Copiar un directorio completo llamado <code>proyecto</code> desde el servidor <code>192.168.1.5</code> al cliente Alpine.</p>
<pre data-role="codeBlock" data-info="text" class="language-text text"><code>Alpine:~# scp -r sshuser1@192.168.1.5:/home/sshuser1/proyecto /home/alpine/
</code></pre></div>
<p>El <strong>comando <code>sftp</code> (SSH File Transfer Protocol)</strong> proporciona una interfaz interactiva pr치cticamente identica a la de un cliente FTP tradicional. Los comandos disponibles dentro de la sesi칩n <code>sftp</code> son los mismos que los de un cliente FTP, como <code>ls</code>, <code>cd</code>, <code>get</code>, <code>put</code>, etc., pero la conexi칩n se realiza de forma segura a trav칠s de SSH.</p>
<div class="admonition example">
<p class="admonition-title">Uso de sftp</p>
<p>Conectarse al servidor <code>192.168.1.5</code> con el usuario <code>sshuser1</code> y descargar un archivo llamado <code>informe.pdf</code> al cliente Alpine.</p>
<pre data-role="codeBlock" data-info="text" class="language-text text"><code>Alpine:~# sftp sshuser1@192.168.1.5
sftp&gt; get informe.pdf
sftp&gt; quit
</code></pre><p>Subir un archivo llamado <code>datos.csv</code> desde el cliente Alpine al servidor <code>192.168.1.5</code> con el usuario <code>sshuser1</code>.</p>
<pre data-role="codeBlock" data-info="text" class="language-text text"><code>Alpine:~# sftp sshuser1@192.168.1.5
sftp&gt; put datos.csv
sftp&gt; quit
</code></pre></div>
<p>No nos extenderemos m치s en el uso de <code>sftp</code> por su analog칤a con FTP, que se trata en la unidad correspondiente a ese protocolo.</p>

      </div>
      
      
    
    
    
    
    
    
  
    </body></html>